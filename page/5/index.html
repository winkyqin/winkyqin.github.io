<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Qin Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Qin Blog">
<meta property="og:url" content="http://winkyqin.com/page/5/index.html">
<meta property="og:site_name" content="Qin Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="WinkyQin">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Qin Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Qin Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://winkyqin.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Bitcoin/精通比特币/2018-03-02-精通比特币-002-比特币原理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/06/13/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-02-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-002-%E6%AF%94%E7%89%B9%E5%B8%81%E5%8E%9F%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2018-06-13T13:05:27.000Z" itemprop="datePublished">2018-06-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/06/13/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-02-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-002-%E6%AF%94%E7%89%B9%E5%B8%81%E5%8E%9F%E7%90%86/">精通比特币-02-比特币原理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="2-1-交易、区块、挖矿和区块链"><a href="#2-1-交易、区块、挖矿和区块链" class="headerlink" title="2.1  交易、区块、挖矿和区块链"></a>2.1  交易、区块、挖矿和区块链</h3><!--
比特币系统与传统的银行和支付系统不同，是基于去中心化的信任。在比特币中，取代中央信任机构的是，信任是通过比特币系统中不同参与者的相互作用达成的。
--> 

<p>在本章中，我们将通过较高层面跟踪比特币系统单笔交易，</p>
<p><strong>观察交易如何通过比特币分布式共识机制变得可信，被接受，并且最终记录在区块链，也就是所有交易的分布式账簿。</strong></p>
<!--随后的章节将深入探讨交易，网络和采矿背后的技术。-->

<h4 id="2-1-1-比特币概述"><a href="#2-1-1-比特币概述" class="headerlink" title="2.1.1 比特币概述"></a>2.1.1 比特币概述</h4><p>如图2-1所示的概览图中，我们可以看到</p>
<p>比特币系统由<strong>用户</strong>（用户通过密钥控制钱包）、<strong>交易</strong>（每一笔交易都会被广播到整个比特币网络）和<strong>矿工</strong>（通过竞争计算生成在<strong>每个节点达成共识</strong>的<strong>区块链</strong>，区块链是一个分布式的公共权威账簿， 包含了比特币网络发生的所有的交易）组成。</p>
<p>本章中的每个示例都基于在比特币网络上进行的实际交易，通过将资金从一个钱包发送到另一个钱包来模拟用户（Joe，Alice，Bob和Gopesh）之间的交互。 </p>
<p>在通过比特币网络跟踪交易到区块链时，我们将使用一个区块链接浏览器站点来显示每个步骤。<br>区块链浏览器（blockchain explorer）是一个作为比特币搜索引擎运行的Web应用程序，它允许您搜索地址，交易和块，并查看它们之间的关系和资金流动。</p>
<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15277397218895.jpg"><br>图2-1比特币网络概览</p>
<p>常见的区块链数据查询网站包括：</p>
<p>▷Bitcoin Block Explorer</p>
<p>▷BlockCypher Explorer▷blockchain.info</p>
<p>▷BitPay Insight</p>
<p>以上每一个查询网站都有搜索功能，可以通过地址，交易哈希值或区块号，搜索到在比特币网络和区块链中对应的数据。我们将给每个交易和区块例子提供一个链接，方便你做详细研究。</p>
<h4 id="2-1-2-买咖啡"><a href="#2-1-2-买咖啡" class="headerlink" title="2.1.2 买咖啡"></a>2.1.2 买咖啡</h4><!--
在之前章节里，Alice是一名刚刚获得第一枚比特币的新用户。在“1.4.2 获取你的第一枚比特币 ”一节中，Alice和她的朋 友Joe会面时，用现金换取了比特币。由Joe产生的这笔交易使得Alice的钱包拥有了0.10比特币。现在Alice将第一次使用比特币在加利福尼亚州帕罗奥图的Bob咖啡店买一杯咖啡。

Bob咖啡店给他的销售网点系统新增加了一个比特币支付选项，价格单上列的是当地货币（美元）的售价，但在收银台，顾客可以选择用美元或比特币支付。此时，Alice点了杯 咖啡，然后Bob将交易键入到收银机，之后销售系统将按照当前市场汇率把美元总价转换为比特币，然后同时显示两种货币的价格：

总价:

$1.50 USD

0.015 BTC

Bob说到，“总共1.50美元，或0.015 BTC比特币”
-->

<p>Bob的自助销售系统还将自动创建一个包含付款请求的二维码。</p>
<p>与一个简单包含目的比特币地址的二维码不同，当前支付请求的是一个二维编码过的URL，它包含有一个目的地址，一笔支付金额，和一个</p>
<!--像“Bob咖啡”这样的-->

<p>交易描述。<br>这使比特币钱包应用在发送支付请求时，可以预先填好支付用的特定信息，给用户显示一种友好易懂的描述。<br>你可以用比特币钱包应用扫描这个二维码来看</p>
<!--Alice可能看到的-->

<p>信息。<br><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278502173909.jpg"></p>
<p>图2-2支付请求二维码</p>
<p>提示尝试用你的钱包扫描这个，看看地址和金额，但不要发送货币。</p>
<p>根据BIP0021的定义，这个付款二维码包括的URL的意思是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitcoin:1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA?</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">amount&#x3D;0.015&amp;</span><br><span class="line">label&#x3D;Bob%27s%20Cafe&amp;</span><br><span class="line">message&#x3D;Purchase%20at%20Bob%27s%20Cafe</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Components of the URL</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A bitcoin address: &quot;1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA&quot;</span><br><span class="line">The payment amount: &quot;0.015&quot;</span><br><span class="line">A label for the recipient address: &quot;Bob&#39;s Cafe&quot;</span><br><span class="line">A description for the payment: &quot;Purchase at Bob&#39;s Cafe&quot;</span><br></pre></td></tr></table></figure>

<p>Alice用她的智能手机扫描了显示的条形码。她的智能手机显示一笔给Bob咖啡店的0.0150比特币的支付请求，然后她按下发送键授权了这笔支付。在几秒钟时间内（大约与信用卡授权所需时间相同）Bob将会在收银台看到这笔交易，并完成交易。</p>
<p>在接下来的章节中，我们将更详细地检视这笔交易，<br>观察Alice的钱包是<strong>怎样构建交易</strong>，<strong>交易又是怎样在网络中广播</strong>、<strong>怎 样被验证</strong>，以及Bob在后续交易中怎样消费那笔钱。</p>
<p>注意从千分之一比特币(1毫比特币）到一亿分之一比特币（1聪比特币），比特币网络可以处理任意小额交易。</p>
<!--
在本书 中，我们将用“比特币”这个术语来表示任意数量的比特币货币，从最小单元（1聪）到可被挖出的所有比特币总数 （21,000,000）。-->

<p>你可以像例1那样使用区块资源管理器站点来检查Alice与Bob’s Cafe的交易:</p>
<p>例1. <a target="_blank" rel="noopener" href="https://blockexplorer.com/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2">查看Alice的交易</a></p>
<h3 id="2-2-比特币交易"><a href="#2-2-比特币交易" class="headerlink" title="2.2 比特币交易"></a>2.2 比特币交易</h3><p>简单来说，交易告知全网：比特币的持有者已授权把比特币转帐给其他人。<br>而新持有者能够再次授权，转移给该比特币所有权链中的其他人，产生另一笔交易来花掉这些比特币，后面的持有者在花费比特币也是用类似的方式。</p>
<h4 id="2-2-1-交易输入输出"><a href="#2-2-1-交易输入输出" class="headerlink" title="2.2.1 交易输入输出"></a>2.2.1 交易输入输出</h4><!--交易就像复式记账法账簿中的行。-->

<p>简单来说，每一笔交易包含一个或多个“输入”，输入是针对一个比特币账号的负债。</p>
<p>这笔交易的另一面，有一个或多个“输出”，被当成信用积分记入到比特币账户中。这些输入和输出的总额（负债和信用）不需要相等。相反，当输出累加略少于输入量时，两者的差额就代表了一笔隐含的“<strong>矿工费</strong>”，这也是将交易放进账簿的矿工所收集到的一笔小额支付。</p>
<!-- 如图2-3描述的是一笔作为记账簿记录的比特币交易。-->
<p> 交易也包含了每一笔被转移的比特币（输入）的所有权证明，它以所有者的数字签名形式存在，并可以被任何人独立验证。</p>
<!--在比特币术语中，“消费”指的是签署一笔交易：转移一笔以前交易的比特币给以比特币地址所标识的新所有者。-->

<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278515243365.jpg"><br>图2-3交易就像复式记账</p>
<h4 id="2-2-3"><a href="#2-2-3" class="headerlink" title="2.2.3"></a>2.2.3</h4><!--
Alice支付Bob咖啡时使用一笔之前的交易作为输入。
在以前的章节中，Alice从她朋友Joe那里用现金换了点比特币。那笔交易创建了一些被Alice的密钥锁定的比特币。在她支付Bob咖啡店的新交易中使用了之前的交易作为输入，并以支付咖啡和找零作为新的输出。-->

<p>交易形成了一条链，最近交易的输入对应以前交易的输出。<br>Alice的<strong>密钥提供了解锁之前交易输出的签名，因此向比特币网络证明她拥有这笔钱。</strong>她将买咖啡的这笔支付附加到Bob的地址上，实现“阻止”那笔输出，明确指明要求是Bob签名才能消费这笔钱。</p>
<!--这就描述了在Alice和Bob之间钱的转移。
      下图展示了从Joe到Alice再到Bob的交易链。-->

<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278518731152.jpg"></p>
<p>图2-5交易链中，一笔交易输出就是另一笔交易的输入</p>
<h4 id="2-2-4-找零"><a href="#2-2-4-找零" class="headerlink" title="2.2.4 找零"></a>2.2.4 找零</h4><p>许多比特币交易都会包括新所有者的地址（买方地址）和当前所有者的地址（称为找零地址）的输出。</p>
<!--这是因为交易输入，就像纸币那样能够，不能再分割。如果您在商店购买了5美元的商品，但是使用20美元的美金来支付商品，您预计会收到15美元的找零。相同的概念适用于比特币交易输入。如果您购买了一个价格为5比特币但只能使用20比特币输入的商品，那么您可以将5个比特币的一个输出发送给商店所有者，并将一个15比特币的输出返回给您自己作为找零（减去任何适用的交易费用）。-->

<p>重要的是，找零地址不必与输入时提供的地址相同，出于隐私的原因，通常是所有者钱包中的新地址。</p>
<!--不同的钱包可以在汇总输入以进行用户请求的付款时使用不同的策略。
它们可能会聚合许多小输入，或者使用等于或大于所需付款的输入。除非钱包可以以这样的方式汇总输入，以便将所需付款与交易费用完全匹配，否则钱包将需要产生一些找零。这与人们如何处理现金非常相似。如果你总是在你的钱包支付时使用最大的面额，你会最终得到一个充满零钱的钱包。如果你只使用零钱，你最终会换来整钱。人们总是在潜意识中在这两个极端之间找到平衡，而比特币钱包开发商也力图实现这种平衡。-->

<p>总的来讲，交易是将钱从交易输入移至输出。输入是指钱币的来源，通常是之前一笔交易的输出。交易输出将约定金额发送到新的所有者的比特币地址，并将找零输出返回原来原来所有者。 一笔交易的输出可以被当做另一笔新交易的输入，这样随着钱从一个地址被移动到另一个地址的同时形成了一条所有权链（如图2-4）。</p>
<h4 id="2-2-5-常见的交易形式"><a href="#2-2-5-常见的交易形式" class="headerlink" title="2.2.5 常见的交易形式"></a>2.2.5 常见的交易形式</h4><p>最常见的交易形式是从一个地址到另一个地址的简单支付，这种交易也常常包含给支付者的“找零”。<strong>一般交易有一个输入和两个输出</strong>，</p>
<p>如图2-5所示:<br><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278521572341.jpg"><br>图2-5最普通的交易</p>
<p><strong>另一种常见的交易形式是集合多个输入到一个输出（如图2-6）的模式。</strong><br>这相当于现实生活中将很多硬币和纸币零钱兑换为一个大额面钞。像这样的交易有时由钱包应用产生来清理许多在支付过程收到的小数额的找零。</p>
<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278521865112.jpg"><br>图2-6打包资金的交易</p>
<p>最后，另一种在比特币账簿中常见的交易形式是将一个输入分配给多个输出，即多个接收者（如图2-7）的交易。这类交易有时被商业实体用作分配资金，例如给多个雇员发工资的情形。<br><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278522212269.jpg"><br>图2-7分散资金的交易</p>
<h3 id="2-3-交易的构建"><a href="#2-3-交易的构建" class="headerlink" title="2.3 交易的构建"></a>2.3 交易的构建</h3><!--Alice的钱包应用知道如何选取合适的输入和输出以建立Alice所希望的交易。-->

<p><strong>Alice只需要指定目标地址和金额，其余的细节钱包应用会在后台自动完成。</strong>很重要的一点是，<strong>钱包应用甚至可以在完全离线时建立交易</strong>。</p>
<!--就像在家里写张支票， 之后放到信封发给银行一样，比特币交易建立和签名时不用连接比特币网络。-->

<p>只有在<strong>执行交易</strong>时才需要将交易发送到网络。</p>
<h4 id="2-3-1-获取正确的输入"><a href="#2-3-1-获取正确的输入" class="headerlink" title="2.3.1 获取正确的输入"></a>2.3.1 获取正确的输入</h4><p>Alice的钱包应用首先要找到一些足够支付给Bob所需金额的输入。<br>大多数钱包应用跟踪着钱包中某个地址的所有可用输出。</p>
<!--因此Alice的钱包会包含她用现金从Joe那里购买的比特币的交易输出副本（参见 在“获取你的第一枚比特币 ”一节）。-->

<p>完整客户端含有整个区块链中所有交易的所有未消费输出副本。这使得钱包既能拿这些输出构建交易，又能在收到新交易时很快地验证其输入是否正确。</p>
<!--然而，完整客户端占太大的硬盘空间，所以大多数钱包使用轻量级的客户端，只保存用户自己的未消费输出。-->

<p>如果钱包客户端没有某一未消费交易输出，它可以通过不同的服务者提供的各种API或完整索引节点的JSON PRC API从比特币网络中拿到这一交易信息。</p>
<p>例子2-1展示了用HTTP GET命令对一个特定URL建立了一个API的请求。这 个URL会返回一个地址的所有未消费交易输出，以提供给需要这些信息的任何应用作为建立新交易的输入而进行消费。 我们用一个简单的HTTP命令行客户端 cURL来获得这个响应数据。</p>
<p>例2-1 查找Alice的比特币地址所有的未消费的输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ curl https:&#x2F;&#x2F;blockchain.info&#x2F;unspent?active&#x3D;1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    &quot;unspent_outputs&quot;:[</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            &quot;tx_hash&quot;:&quot;186f9f998a5...2836dd734d2804fe65fa35779&quot;,</span><br><span class="line">            &quot;tx_index&quot;:104810202,</span><br><span class="line">            &quot;tx_output_n&quot;: 0,</span><br><span class="line">            &quot;script&quot;:&quot;76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac&quot;,</span><br><span class="line">            &quot;value&quot;: 10000000,</span><br><span class="line">            &quot;value_hex&quot;: &quot;00989680&quot;,</span><br><span class="line">            &quot;confirmations&quot;:0</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例2-2的响应数据显示了在Alice的地址 1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK 上面有一个未消费输出（还未被兑换）。这个响应包含一个交易的引用。而从Joe那里转过来的未消费输入就包含在这个交易里面，它的价值是一千万聪 （satoshi），即 0.10比特币。通过这个信息，Alice的钱包应用就可以创建新的交易将钱转账到新地址。</p>
<p>提示点击这里 查看Joe和Alice间的交易信息。</p>
<p>如你所见，Alice的钱包在单个未消费的输出中有足够的比特币支付一杯咖啡。假如不够的话，Alice的钱包应用就不得不搜寻一些小的未消费输出，像是从一个存钱罐里找硬币一样，直到找到足够支付咖啡的数量。在两种情境下，可能都需要找回零钱，而这些找零也会是钱包所创建的交易的输出组成部分。我们会在下一节会有所描述。</p>
<h4 id="2-3-2-创建交易输出"><a href="#2-3-2-创建交易输出" class="headerlink" title="2.3.2 创建交易输出"></a>2.3.2 创建交易输出</h4><p>交易的输出会被创建成为一个包含这笔数额的脚本的形式，只能被引入这个脚本的一个解答后才能兑换。简单点说就 是，Alice的交易输出会包含一个脚本，这个脚本说 “这个输出谁能拿出一个签名和Bob的公开地址匹配上，就支付给谁”。因为只有Bob的钱包的私钥可以匹配这个地址，所以只有Bob的钱包可以提供这个签名以兑换这笔输出。因此Alice 会需要Bob的签名来包装一个输出。</p>
<p>这个交易还会包含第二个输出。因为Alice的金额是0.10比特币的输出形式，对0.015 比特币一杯的咖啡来说太多了，需要找Alice 0.085比特币的零钱。Alice钱包创建给她的零钱的支付就在付给Bob的同一个交易里面。可以说，Alice的钱包将她的金额分成了两个支付：一个给Bob，一个给自己。她可以在以后的交易里消费这笔零钱输出。</p>
<p>最后，为了让这笔交易尽快地被网络处理，Alice的钱包会多付一小笔费用。这个不是明显地包含在交易中的；而是通过输入和输出的差值所隐含的。如果Alice创建找零时只找 0.0845比特币，而不是 0.085比特币的话，这里就有剩下 0.0005比特币（50万聪） 。因为加起来小于 0.10，所以这个 0.10 比特币的输入就没有被完整的消费了。这个差值会就被矿工当作交易费放到区块的交易里，最终放进区块链帐薄中。</p>
<p>这个交易的结果信息可以用区块链数据查询站点看到，如图2-8所示。<br><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278525437475.jpg"><br>图2-8 Alice和Bob咖啡店的交易</p>
<p>提示点击这里查看Alice支付Bob咖啡的交易的信息</p>
<h4 id="2-3-3-将交易放到总账簿中"><a href="#2-3-3-将交易放到总账簿中" class="headerlink" title="2.3.3 将交易放到总账簿中"></a>2.3.3 将交易放到总账簿中</h4><p>这个被Alice钱包应用创建的交易大小为258字节，包含了确认资金所有权和分配给新所有者所需要的全部信息。</p>
<p>现在，这个交易必须要被传送到比特币网络中以成为分布式账簿（区块链）的一部分。</p>
<p>在下一节里，<br>我们来看下一个<strong>交易如何成为新区块的一部分</strong>， 以及<strong>区块是如何被挖矿构建的</strong>。<br>最后，<br>我们会看看<strong>新区块被加进区块链后，是如何随更多区块的添加而增加可信度的</strong>。</p>
<h5 id="2-3-3-1-交易的传送"><a href="#2-3-3-1-交易的传送" class="headerlink" title="2.3.3.1 交易的传送"></a>2.3.3.1 交易的传送</h5><!--
因为这个交易包含处理所需的所有信息，所以这个交易是被如何或从哪里传送到比特币网络的就无所谓了。
-->

<p>比特币网络是由参与的比特币客户端联接几个其他比特币客户端组成的P2P网络。<br>比特币网络的目的是将交易和区块传播给所有参与者。</p>
<h5 id="2-3-3-2-如何传播"><a href="#2-3-3-2-如何传播" class="headerlink" title="2.3.3.2 如何传播"></a>2.3.3.2 如何传播</h5><p>“说着”比特币协议，从而实现参与比特币网络的任何系统（例如服务器，桌面应用程序或钱包）都称为比特币节点。</p>
<p>Alice的钱包应用可以<strong>发送新的交易给其它任意一个已联接到互联网的比特币客户端</strong>，不论其是由有线网、WiFi、还是通过手机联接的。</p>
<p><strong>她的钱包不必直接连着Bob的比特币钱包，且她不必使用咖啡厅提供的网络联网，虽然这两者都是可能的。</strong></p>
<p>任何比特币网络节点（其它客户端）<strong>收到一个之前没见过的有效交易时会立刻将它转发给联接到自身的其它节点</strong>。<br>因此，这个交易迅速地从P2P网络中传播开来，几秒内就能到达大多数节点。</p>
<h5 id="2-3-3-3-Bob的视角"><a href="#2-3-3-3-Bob的视角" class="headerlink" title="2.3.3.3 Bob的视角"></a>2.3.3.3 Bob的视角</h5><p>如果Bob的比特币钱包应用是直接连接Alice的钱包应用的话，Bob的钱包应用也许就是第一个收到这个交易的节点。<br>然而，即使Alice的交易是从通过其它节点发过来的，一样可以在几秒钟内到达Bob钱包应用这里。<br>Bob的钱包会立即确认 Alice的交易是一个收入支付，因为它包含能用Bob的私钥兑换的输出。<br>Bob的钱包应用也能够独立地用之前未消费输入来确认这个交易是正确构建的，并且由于包含足够交易费会被下一个区块包含进去。</p>
<p>这时Bob只需冒很小的风险，因为这个交易会很快被加到区块且被确认。</p>
<p>提示一个对比特币交易的常见误解是<strong>它们必须要等10分钟后被确认加进一个新区块，或等60分钟以得到六次确认后才是有效的</strong>。</p>
<p>虽然这些确认可以确保交易已被整个网络接受，但对于像一杯咖啡这样的小额商品来说就没有必要等待那么长时间了。<br>一个商家可以免确认来接受比特币小额支付。<br>这样做的风险不比接受一个不是用有效身份证领取或没有签名的信用卡的风险更大，而后者是现在商家常做的事情。</p>
<h3 id="2-4-比特币挖矿"><a href="#2-4-比特币挖矿" class="headerlink" title="2.4 比特币挖矿"></a>2.4 比特币挖矿</h3><p>这个交易现在在比特币网络上传播开来。<br>但只有被一个称为挖矿的过程验证且加到一个区块中之后，这个交易才会成为 这个共享账簿（区块链）的一部分。</p>
<p>关于挖矿的详细描述请见第10章。<br>比特币系统的信任是建立在计算的基础上的。交易被包在一起放进区块中时需要极大的计算量来证明，但只需少量计算就能验证它们已被证明。</p>
<p><strong>挖矿在比特币系统中有两个重要作用</strong>：</p>
<p>▷ 挖矿节点通过参考比特币的共识规则验证所有交易。<br>因此，挖矿通过拒绝无效或畸形交易来提供比特币交易的安全性。</p>
<p>▷ <strong>挖矿在构建区块时会创造新的比特币，和一个中央银行印发新的纸币很类似。</strong>每个区块创造的比特币数量是固定的， 随时间会渐渐减少。</p>
<p>挖矿在成本和报酬之间取得了良好的平衡。 <strong>挖矿采用电力来解决数学问题</strong>。<br>一个成功的矿工将以新的比特币和交易费的形式获取奖励。<br>但是，只有矿工正确验证了所有的交易，才能获得奖励，才能达到协商一致的规则。 这种微妙的平衡为没有中央权力机构的比特币提供安全保障。</p>
<p>描述挖矿的一个好方法是将之类比为一个巨大的多人数独谜题游戏。一旦有人发现正解之后，这个数独游戏会<strong>自动调整难度以使游戏每次需要大约10分钟解决。</strong>想象一个有几千行几千列的巨大数独游戏。如果给你一个已经完成的数独， 你可以很快地验证它。然而，如果这个数独只有几个方格里有数字其余方格都为空的话，就会花费非常长的时间来解决。这个数独游戏的困难度可以通过改变其大小（更多或更少行列）来调整，但即使它非常大时验证它也是相当容易的。而比特币中的 “谜题” 是基于哈希加密算法的，其展现了相似的特性：非对称地，它解起来困难而验证很容易，并且它的困难度可以调整。</p>
<p>在 “比特币的应用、用户和他们的故事”一节中，我们提到了一个叫Jing的在上海学计算机工程的学生。Jing在比特币网络中扮演了一个矿工的角色。大概每10分钟，Jing和其他上千个矿工一起展开一场对一个区块的交易寻找正解的全球竞赛。</p>
<p>为寻找这个解，也被称为工作量证明，整个网络需要具有每秒亿万次哈希计算的能力。</p>
<p>这个<strong>工作量证明算法</strong>指的用SHA256加密算法不断地对区块头和一个随机数字进行哈希计算，直到出现一个和预设值相匹配的解。<br>第一个找到这个解的矿工会赢得这局竞赛并会将此区块发布到区块链中。</p>
<!--Jing从2010年开始挖矿，当时他使用一个非常快的桌面电脑来为新区块寻找正解。随着更多的矿工加入比特币网络中， 寻找谜题正解的困难度迅速增大。不久，Jing和其他矿工升级成更专业的硬件，比如游戏桌面电脑或控制台专用的高端 独享图像处理单元芯片（即显卡GPU）。在写这本书的时候，解题已经变得极其困难，只有使用集成了几百个挖矿专用算法硬件并能同时在一个单独芯片上并行工作的专用集成电路（ASIC）挖矿才会营利。Jing的公司同时加入了一个类似彩票奖池的、能够让多个矿工共享计算力和报酬的矿池。Jing现在运行两个通过USB联接的ASIC机器每天24小时不间断地挖 矿。他卖掉一些挖矿所得到的比特币来支付电费，通过收益获得一些收入。-->

<h3 id="2-5-区块中的挖矿交易记录"><a href="#2-5-区块中的挖矿交易记录" class="headerlink" title="2.5 区块中的挖矿交易记录"></a>2.5 区块中的挖矿交易记录</h3><p>新交易不断地从用户钱包和应用流入比特币网络。<br>当比特币网络上的节点看到这些交易时，会先将它们放到各自节点维护的一个临时的未经验证的交易池中。<br>当矿工构建一个新区块时， 会将这些交易从这个交易池中拿出来放到这个新区块中，然后通过尝试解决一个非常困难的问题（也叫工作量证明）以证明这个新区块的合法性。挖矿过程的细节会在“挖矿简介”一节中详加描述。</p>
<p>这些交易被加进新区块时，以交易费用高的优先以及其它的一些规则进行排序。矿工一旦从网络上收到一个新区块时， 会意识到在这个区块上的解题竞赛已经输掉了，会马上开始下一个新区块的挖掘工作。<br>它会立刻将一些交易和这个新区块的数字指纹放在一起开始构建下一个新区块，并开始给它计算工作量证明。<br>每个矿工会在他的区块中包含一个特殊的交易，将新生成的比特币（当前每区块为12.5比特币）作为报酬支付到他自己的比特币地址，再加上块中所有交易的交易费用的总和作为自己的报酬。<br>如果他找到了使得新区块有效的解法，他就会得到这笔报酬，因为这个新区块被加入到了总区块链中，他添加的这笔报酬交易也会变成可消费的。 参与矿池的Jing设置了他的软件，使得构建新区块时会将报酬地址设为矿池的地址。然后根据各自上一轮贡献的工作量将所得的报酬分给Jing和其他参与矿池挖矿的矿工。</p>
<p>Alice的交易被网络拿到后放进未验证交易池中。一旦被挖矿软件验证，它就被包含在由Jing的采矿池生成的新块（称为候选块）中。<br>参与该采矿池的所有矿工立即开始计算候选块的工作证明。<br>大约 在Alice的钱包第一次将这个交易发送出来五分钟后，Jing的ASIC矿机发现了新区块的正解并将这个新区块发布到网络上后，一旦被其它矿机验证，它们就会立即投身到构建新区块的竞赛中。</p>
<p>Jing的ASIC矿机发现了新区块的正解并将之发布为第277,316号区 块，包含420个交易，包括Alice的交易。<br>包含Alice交易的区块对这个交易来说算一次”确认”。</p>
<p>提示你可以查看包含Alice交易记录的这个区块的信息。</p>
<p>大约19分钟后，第277,317号新区块诞生在另一个挖矿节点中。<br>因为这个新区块是在包含Alice交易的第277,316号区块的上层（栈），在这个区块的基础上增加了更多的计算，因此就加强了这些交易的可信度。基于这个区块每产生一个新区块，对这个交易来说就会增加了一次”确认”。当区块一个个堆上来时，这个交易变得指数级地越来越难被推翻，因此它在网络中得到更多信任。</p>
<p>在图2-9中，我们可以看到包含Alice的交易的第277,316号区块。在它之下有377,361个区块（包括0号区块），像链子 一样一个连着一个（区块链），一直连到0号区块，即创世区块。随着时间变长，这个区块链的高度也随之增长，每个区块和整个链的计算复杂度也随之增加。包含Alice的交易的区块后面形成的新区块使得信任度进一步增加，因为他们叠加了更多的计算在这个越来越长的链子上。</p>
<p>按惯例来说，<strong>一个区块获得六次以上“确认”时就被认为是不可撤销的了，因为要撤销和重建六个区块需要巨量的计算</strong>。</p>
<p>在第10章我们会详细描述挖矿和信任建立的过程。<br><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278534242269.jpg"><br>图2-9Alice的交易包括在区块277316</p>
<h3 id="2-6-消费这笔交易"><a href="#2-6-消费这笔交易" class="headerlink" title="2.6 消费这笔交易"></a>2.6 消费这笔交易</h3><p>既然Alice的这笔交易已经成为区块的一部分被嵌入到了区块链中，它就成为了整个分布式比特币账簿的一部分并对所有比特币客户端应用可见。每个比特币客户端都能独立地验证这笔交易是有效且可消费的。全节点客户端可以追溯钱款的来源，从第一次有比特币在区块里生成的那一刻开始，按交易与交易间的关系顺藤摸瓜，直到Bob的交易地址。轻量级客户端通过确认一个交易在区块链中且在它后面有几个新区块来确认一个支付的合法性。这种方式叫做简易支付验证（参 见“简易支付验证（SPV）节点”）。</p>
<p>Bob现在可以将此交易和其它交易的结果信息作为输入，创建新的所有权为其他人的交易。这样就实现了对此交易的消费。举个例子，Bob可以用Alice支付咖啡的比特币转账给承包商或供应商以支付相应费用。大多数情况下，Bob用的比特币客户端会将多个小额支付聚合成一个大的支付，也许会将一整天的比特币收入聚合成一个交易。这样会将多个支付合成到咖啡店财务账户的一个单独地址。图2-10为交易集合示例。</p>
<p>当Bob花费从Alice和其他顾客那里赚得的比特币时，他就扩展了比特币的交易链条。而这个链条会被加到整个区块链账簿，使所有人知晓并信任。我们假定Bob向在邦加罗尔的网站设计师Gopesh支付一个新网页的设计费用。</p>
<p>那么区块交易链如图2-10所示。<br><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15278534692884.jpg"><br>在本章中，我们看到了交易如何被构建为一个链，并将价值从一个所有者转移到所有者。 我们还追踪了Alice的交易，从她的钱包中创建的那一刻起，通过比特币网络被矿工记录在区块链。<br>在本书的其余部分，我们将<strong>研究钱包，地址，签名，交易，网络和最终挖矿</strong>等背后的具体技术。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/06/13/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-02-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-002-%E6%AF%94%E7%89%B9%E5%B8%81%E5%8E%9F%E7%90%86/" data-id="ckmsza5uz00bxow44d2ui16cy" data-title="精通比特币-02-比特币原理" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/精通比特币/2018-03-01-精通比特币-001-介绍" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/06/13/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-001-%E4%BB%8B%E7%BB%8D/" class="article-date">
  <time class="dt-published" datetime="2018-06-13T12:35:59.000Z" itemprop="datePublished">2018-06-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/06/13/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-001-%E4%BB%8B%E7%BB%8D/">精通比特币-01-介绍</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="1-1-什么是比特币？"><a href="#1-1-什么是比特币？" class="headerlink" title="1.1 什么是比特币？"></a>1.1 什么是比特币？</h3><p>比特币是由一系列概念和技术作为基础构建的<strong>数字货币生态系统</strong>。</p>
<p>狭义的“比特币”代表系统中的<strong>货币单位</strong>，用于储存和传输价值。</p>
<!--用户主要通过互联网使用比特币系统，当然其他网络也可以使用。
比特币协议以各种开源软件的形式实现，这些软件可以在笔记本电脑、智能手机等多种设备上运行，让用户方便地接入比特币系统。-->

<!--比特币可以做传统货币能做的所有事，例如买卖商品、给个人或组织汇款、贷款。用户可以在专门的交易所里买卖比特币或兑换其他货币。在一定意义上，比特币才是互联网货币的完美形态。因为它具有快捷、安全、无国界的特性。-->

<p>不同于传统货币，比特币是完全虚拟的。它不但没有实体，本质上也没有一种虚拟物品代表比特币。</p>
<p><strong>比特币隐含在收发币的转账记录中。</strong></p>
<p>用户只要有证明其控制权的密钥，用密钥解锁，就可以发送比特币。<br>这些密钥通常存储在计算机的数字钱包里。</p>
<p><strong>拥有密钥是使用比特币的唯一条件，这让控制权完全掌握在每个人手中。</strong></p>
<p>比特币是一个分布式的点对点网络系统。</p>
<!--因此没有“中央”服务器，也没有中央发行机构。比特币是通过“挖矿”产生的，挖矿就是验证比特币交易的同时参与竞赛来解决一个数学问题。任何参与者（比如运行一个完整协议栈的人）都可以做矿工，用他们的电脑算力来验证和记录交易。平均每10分钟就有人能验证过去这10分钟发生的交易，他将会获得新币作为工作回报。本质上，挖矿把央行的货币发行和结算功能进行分布式，用全球化的算力竞争来取代对中央发行机构的需求。
-->

<p><strong>比特币系统包含调节挖矿难度的协议。</strong></p>
<!--挖矿——在比特币网络中成功写入一个区块交易——的难度是动态调整的，保证不管有多少矿工（多少CPU）挖矿，平均每10分钟只有一个矿工成功。-->

<!--比特币协议还规定，每四年新币的开采量减半，同时限制比特币的最终开采总量为2,100万枚。这样，流通中的比特币数量非常接近一条曲线，并将在2140年比特币将达到2,100万枚。由于比特币的开采速度随时间递减，从长期来看，比特币是一种通货紧缩货币。此外，不能通过“印刷”新比特币来实现“通货膨胀”。-->

<p><strong>比特币是一种协议、一种网络、一种分布式计算创新的代名词。</strong></p>
<!--比特币是这种创新的首次实际应用。作为一个开发者，我看比特币之于货币就像看到当年的互联网，一个通过分布式计算来传播价值和保障数字资产所有权的网络。比起初识比特币，这里将知无不言。-->

<p>在本章中，我们从一些主要概念和术语入手，告诉你<br><strong>如何获取软件并使用比特币进行简单的交易。</strong><br>接下来的章节，我们会逐步讲解<br><strong>比特币背后的技术细节，分析比特币网络和比特币协议的内部运行机制</strong>。</p>
<!--
####比特币诞生之前的数字货币
> 切实可行的数字货币的出现是与密码学发展息息相关的。基本的挑战在于，当一个人考虑到用比特来代表可以兑换商品和服务的价值时，接受数字货币也就不足为奇。任何接受数字货币的人都面临的两个基本问题是：

1. 我能相信这钱是真实可信的，而不是伪造的吗？
2. 我能确定没人说这笔钱是他们的，而不是我的吗？（**又名“双重支付”问题**）

纸币的发行机构不断的利用日益复杂的纸张和打印技术来遏制造假问题。实物货币很容易解决双重支付问题，因为同一张纸币不可能会同时出现在两个不同的地方。当然，传统货币也经常数字化储存和数字化传输。在这些情况下，假币和双重支付问题是被中央权威机构的处理方式是清除所有的电子交易记录，该中央权威在流通中持有一种全球通货观。对于数字货币来说，不能有效利用秘制油墨印刷技术或条形全息图，密码学为用户所主张的合法性价值提供了信任的基础。具体地来说，加密数字签名能够使一个用户签署一项能够提供其资产所有权证明的数字资产或数字交易。采用适当的结构，数字签名也可以用于解决双重支付的问题。

在20世纪80年代后期，当密码学开始越来越广泛地使用并被理解时，许多研究人员开始尝试使用密码学来建立数字通货。这些早期的数字通货项目发行的数字货币，通常倚靠一种国家通货或像黄金一样的贵金属。

虽然这些早期的数字通货成型了，他们却是中心化的，因此，他们很容易遭受到政府和黑客的攻击。早期的数字通货使用了一个中央结算所来处理所有的定期交易，就像一个传统的银行系统。不幸的是，在大多数情况下，这些新兴的数字货币成为了政府担忧的目标，最终从法律程序上消失了。另一些则是在发行这些数字货币的母公司突然违约时颓然失败了。为了坚定的抵制对手的介入，无论这些对手是合法的政府或是犯罪分子，去中心化的数字货币需要的是避免单节点攻击。比特币正是这样的系统，设计完全去中心化，不被任何中央政权或中央点控制，这样的货币系统是不会遭受攻击，也不会变得腐败。

比特币代表了数十年的密码学和分布式系统的巅峰之作，这是一个独特而强大的组合，汇集了四个关键的创新点。

-->

<p>比特币由这些构成：<br>▷ 一个去中心化的点对点网络（<strong>比特币协议</strong>）<br>▷ 一个公共的交易账簿（<strong>区块链</strong>）<br>▷ 一个去中心化的数学的和确定性的货币发行（<strong>分布式挖矿</strong>）<br>▷ 一个去中心化的交易验证系统（<strong>交易脚本</strong>）</p>
<h3 id="1-2-比特币发展史"><a href="#1-2-比特币发展史" class="headerlink" title="1.2 比特币发展史"></a>1.2 比特币发展史</h3><!--
2008年，一位化名为中本聪的人，在一篇名为《比特币：一个点对点的电子现金系统》的论文中首先提出了比特币。中本聪结合以前的多个数字货币发明，如B-money和HashCash，创建了一个完全去中心化的电子现金系统，不依赖于通货保障或是结算交易验证保障的中央权威。
-->

<p>关键的创新是利用分布式计算系统（称为<strong>“工作量证明”算法</strong>）每隔10分钟进行一次的全网“选拔”，能够使去中心化的网络同步交易记录。</p>
<p>这个能优雅的解决<strong>双重支付问题</strong>，即一个单一的货币单位可以使用两次。此前，双重支付问题是数字货币的一个弱点，并通过一个中央结算机构清除所有交易来处理。</p>
<!--
根据中本聪发表的一篇涉及比特币网络运行的论文，比特币网络自从被许多其他的程序员修订之后，于2009年启动。分布式计算，为比特币提供了成倍增长的安全性和韧性，现在超过了世界顶级超级电脑的联合处理能力。根据比特币兑美元汇率，比特币的总市场估值为50至100亿美元。目前从全网来看，比特币处理的最大交易额为1.5亿美元，这笔交易及时处理和转账，没有缴纳任何手续费。

中本聪在2011年4月退出公众视野，将比特币代码开发与网络建设的重任留给了欣欣向荣的社区成员。而“中本聪”究竟是谁，时至今日仍然是未解之谜。然而，比特币系统的运行，既不依赖于中本聪，也不依赖于其他任何人——比特币系统依赖于完全透明的数学原理。这项发明本身就是开创性的，它已经蔓延到了分布式计算、经济学、计量经济学领域。
-->

<blockquote>
<p>####一个分布式计算问题的解决方案</p>
</blockquote>
<!--
> 中本聪的此项发明，对“拜占庭将军”问题也是一个可行的解决方案，这是一个在分布式计算中未曾解决的问题。

> 简单来说，这个问题包括了试图通过在一个不可靠、具有潜在威胁的网络中，通过信息交流来达成一个行动协议共识。
-->

<blockquote>
<p>中本聪的<strong>解决方案是使用工作量证明的概念在没有中央信任机构下达成共识</strong>，这代表了分布式计算的科学突破，并已经超越了货币广泛的适用性。</p>
</blockquote>
<blockquote>
<p>它可以用来达成去中心化的网络共识来公正选举、彩票、资产登记，以及数字化公证等等。</p>
</blockquote>
<h3 id="1-3-比特币的应用、用户和他们的故事"><a href="#1-3-比特币的应用、用户和他们的故事" class="headerlink" title="1.3 比特币的应用、用户和他们的故事"></a>1.3 比特币的应用、用户和他们的故事</h3><!--
比特币是一项技术，但它所传递的货币从实质上来说，是一种人与人之间价值交换的基础语言。让我们通过他们的故事，来看看使用比特币的人和一些最常用的通货和协议。我们将会反复用到这些贯穿本书的故事，以此来说明现实生活中数字货币的用途，以及他们是如何通过比特币的各种技术使之成为可能的。
-->

<p>######北美低价零售 </p>
<!--
Alice住在北加州的旧金山湾区。她已经从她的科技迷朋友口中得知了比特币，想要开始使用它。我们会跟进她的故事，来了解比特币，获取一些，并在帕洛阿尔托的Bob家咖啡店用比特币购买一杯咖啡。这个故事会从零售的消费者角度向我们介绍比特币软件，交易平台，以及基本的交易。
-->

<p>######北美高价零售 </p>
<!--
Carol是一位旧金山艺术画廊的主人。她出售昂贵的油画来换取比特币。这个故事将介绍高额商品的零售商们所面临的“51％”攻击的风险。
-->
<p>######离岸合同服务 </p>
<!--
Bob是帕洛阿尔托一家咖啡店的老板，正在建设一个新网站。他曾与一个住在印度班加罗尔的网站开发者Gopesh签订了协议。Gopesh已同意比特币支付。这个故事将研究使用比特币进行海外购、合约服务，以及国际电汇。
-->

<p>######慈善捐赠 </p>
<!--
Eugenia是菲律宾一家儿童慈善机构的董事。最近，她发现了比特币，并希望利用它来和一个全新的国内外捐助群体接洽，以此为她的慈善募捐。她还研究如何使用比特币快速优化资金配置。这个故事将会演示用比特币来进行跨币种跨国界的全球融资，展示慈善组织所使用的公开透明账簿。
-->

<p>######进口/出口 </p>
<!--
Mohammed是迪拜一位电子进口商。他试着用比特币来进行快捷支付，进口美国和中国的电子产品到阿联酋。这个故事将示范用比特币来支付大型企业间实物商品的国际收支。
-->

<p>######比特币挖矿 </p>
<!--
Jing是上海一名计算机工程专业的学生。他建了一个用来挖比特币的矿机，使用他的专业技能来为自己创收。这个故事将审查基于比特币的“工业”：用于确保比特币网络安全和发行新货币的特殊设备。

这些故事都是根据真实行业内的真实人物原型来的，他们正在用比特币创造新市场，创造新产业，用比特币这个新兴事物来解决全球经济问题。
-->

<h3 id="1-4-入门"><a href="#1-4-入门" class="headerlink" title="1.4 入门"></a>1.4 入门</h3><!--加入比特币网络并开始使用通货，所有用户需要做的就是下载应用程序或使用在线应用程序。因为比特币是一个标准，也有许多运行比特币的客户端软件。还有一个标准客户端，也称为中本聪客户端，这是由一个开发团队管理的一个开源项目，源自于中本聪编写的初始客户端。-->

<p>比特币客户端的三种主要形式是：</p>
<p>######完整客户端 </p>
<p>一个完整客户端，或称“全节点”，是存储所有比特币交易的整个交易历史（由每一个用户完成的每一笔交易，曾经所有的每一笔）的客户端，管理用户的钱包，并可以在比特币网络上直接开始交易。</p>
<!--这类似于一个独立的电子邮件服务器，因为它处理着协议的各个方面，而不依赖于任何其它的服务器或第三方服务。
-->

<p>######轻量级客户端 </p>
<p>一个轻量级客户端存储用户的钱包，但需要依赖第三方服务器才能进行比特币交易，才能接入比特币网络。轻量级客户端不保存所有交易的完整副本，因此必须信赖第三方的服务器来获取交易确认。</p>
<!--这就类似于一个独立的电子邮件客户端，能够通过邮箱服务器来访问一个邮箱，因为它在网络交流中依赖于一个第三方服务器。-->

<p>######在线客户端</p>
<p>在线客户端通过网页浏览器在第三方服务器上访问和储存该用户的钱包。</p>
<!--这类似于在线邮件，因为它完全依赖于第三方服务器。-->

<blockquote>
<p>######移动客户端</p>
</blockquote>
<blockquote>
<p>智能手机的移动客户端，例如基于Android系统，既可以作完整客户端运行，也可作为轻量级客户端或在线客户端。</p>
</blockquote>
<blockquote>
<p>一些移动客户端是与在线客户端或桌面客户端同步的，提供跨多个设备但有一个共同的资金源的多平台钱包。</p>
</blockquote>
<!--
比特币客户端的选择，取决于用户想要管理资金的数目。一个完整的客户端将为用户提供最高级的管理和独立性。这样钱包的备份和安全责任就转移到了用户身上。另一种选择是在线客户端，其设置和使用是最简单的，但在线客户端的取舍还在于需衡量第三方介入的风险，因为安全性和控制权是由用户和网页服务商所共同承担的。如果一个在线钱包服务遭受了损失，就像已发生过的那样，用户们可能会失去所有的资金。反过来看，如果用户的一个完整客户端没有进行适当的备份，他们可能会因为电脑的操作失误而丢失他们的资金。-->

<!--
这本书的目的在于，我们将演示各种可下载的比特币客户端的使用方法，从原版客户端（中本聪客户端）到在线钱包。

一些案例将使用到原版客户端，除了作为一个完整的客户端以外，也会公开钱包的API，网络和交易服务。
如果您计划进入比特币系统探索编程的话，将会需要原版客户端。
-->

<h4 id="1-4-1-快速入门"><a href="#1-4-1-快速入门" class="headerlink" title="1.4.1 快速入门"></a>1.4.1 快速入门</h4><!--我们在“1.3 比特币的应用、用户和他们的故事 ”一节中介绍了Alice，她并不是技术性用户，最近才从一个朋友那听说了比特币。

她通过浏览比特币官方网站bitcoin.org开始了自己的比特币之旅，在官网上，她发现了很多种可供选择的比特币客户端。她根据官网提供的建议，选择了轻量级的Multibit客户端。

Alice通过官网bitcoin.org上提供的链接，在她的电脑里下载安装了Multibit客户端。
-->

<p>目前Multibit电脑客户端有WindowsWindows, Mac OS 和 Linux版本。</p>
<blockquote>
<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15270960036724.jpg"></p>
</blockquote>
<blockquote>
<p>比特币钱包必须由一个密码或密令来保护。有许多试图破解弱密码的潜在威胁，所以要注意谨慎设置一个不会被轻易破解的密码。</p>
</blockquote>
<blockquote>
<p>密码应使用大小写字母、数字和符号的组合，避免出现生日、球队名字等个人信息。避免使用任何能在字典里轻易找到的词语，不管这个词语是什么语言的。</p>
</blockquote>
<blockquote>
<p>如果条件允许，可以利用密码生成器生成一个完全随机的12位以上的密码。请记住：比特币是一种随时能被转移到世界其他任何地方的货币。如果不加以妥善保管，会很容易被偷走。</p>
</blockquote>
<p>Alice下载并安装了Multibit客户端后，打开程序就会出现一个欢迎界面，如图1-1所示：</p>
<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15270960579523.jpg" alt="-w370"></p>
<p>Multibit客户端会<strong>自动为Alice生成一个钱包和一个全新的比特币地址</strong>，点击图1-2所示的请求标签即可看到。</p>
<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15270960903464.jpg" alt="-w301"></p>
<p>界面中最重要的是Alice的比特币地址。</p>
<!--类似于电子邮件的地址，Alice可以分享这个地址，这样任何人都可以通过这个地址直接将比特币发送到的新钱包里。界面上看起来一长串的字母和数字就是地址：-->

<p>地址旁是一个二维码。</p>
<!--
这个二维码是可以被智能手机摄像头扫描到该钱包地址的条形码，即窗口右边黑白相间的方块。通过点击比特币地址或二维码旁边的复制按钮，Alice可以将它们分别复制到剪贴板。点击二维码可以将其放大，便于智能手机扫描。

Alice也可以打印出这个地址二维码给别人，这样就不用打一长串字母和数字了。
-->

<p>比特币地址以数字1或3开头。<br>类似于电子邮件地址，这些地址可以分享给其他的比特币的用户，这样他们就可以直接通过这些地址发送比特币到你的钱包里。<br>不同于电邮地址的是，你可以任意地创建新的比特币地址，这些地址都能成功地将资金转到你的钱包。</p>
<p><strong>钱包是多个地址和解锁资金密钥的简单集合。</strong><br>每笔交易你都可以使用不同的地址，这有利于提高隐私的安全性。用户可创建地址的数量几乎不受限制。</p>
<!--现在Alice已经准备好开始使用她的新比特币钱包了。-->

<h4 id="1-4-2-获取你的第一枚比特币"><a href="#1-4-2-获取你的第一枚比特币" class="headerlink" title="1.4.2 获取你的第一枚比特币"></a>1.4.2 获取你的第一枚比特币</h4><!--
现在你还无法在银行或是外币兑换处买到比特币。截至2014年，在大多数国家，购买比特币还是相当困难的。你可以去一些专门的通货交易所，购买比特币或是出售比特币换取当地货币，交易所是以在线通货市场的方式来运营。包括以下几种：

Bitstamp 
一个欧洲通货市场，通过电汇方式，支持包括欧元、美元在内的多币种交易。

Coinbase 
美国比特币钱包，也是买家和卖家进行比特币交易的一个平台。 Coinbase允许用户通过ACH系统来连接美国支票账户，这样易于购买和出售比特币。

这一类的数字加密货币交易所，在国家货币和加密货币夹缝中求生存。因此，会受各国法规和国际法规的制约，而且往往会具体到某单个国家或经济区，并只限于该地区的国家货币。你所选择的货币交易所，只限于你使用的本国货币，也只能是在你国范围内合法运营的交易所。类似于在银行开户，用此类服务来设置这些必要的账户需要花费数日或数周的时间，因为他们需要各种形式来了解你的客户，确认交易将符合反洗钱法。一旦你拥有了交易所的一个账户，你就可以像用代理账户购买出售外币一样的，更快捷地购买或出售比特币了。

bitcoin charts是提供价格索引的站点，一个包括数十家货币交易所其他市场数据的站点，在这里你可以找到更完整的数据。

-->

<p>新用户有以下四种方法来获取比特币：</p>
<p>▷ 找个有比特币的朋友，直接向他购买一些。很多比特币用户都是这样开始的。<br>▷ 利用localbitcoins.com这样的分类服务网站来寻找你所在地区的卖家，使用现金进行面对面的线下交易。<br>▷ 出售某种产品或服务来换取比特币。如果你是个程序员，可以出售你的编程技能。<br>▷ 使用你所在地区的比特币ATM机。利用CoinDesk里的在线地图来找到你附近的比特币取款机。</p>
<!--
Alice是经朋友介绍认识比特币的，所以在等待加州通货市场上的账号被验证和激活的同时，她轻而易举的就获取了她的第一枚比特币。-->


<h4 id="1-4-3-发送和接受比特币"><a href="#1-4-3-发送和接受比特币" class="headerlink" title="1.4.3 发送和接受比特币"></a>1.4.3 发送和接受比特币</h4><p>Alice已经创建好她的比特币钱包，准备接收资金了。<br>她的钱包程序随机生成了一个私钥（关于私钥的详细介绍见“4.1.3 私钥“）和对应的比特币地址。</p>
<p>这时，她的比特币地址还未在全网公布，也未在在任何比特币系统中“登记”。她的比特币地址只是一串数字，对应一个她可以掌控的资金私钥。在该地址和账户之间还没有任何交易产生，也没有任何关联。直到这个地址接收到在比特币账簿（区块链）中公布过的一笔交易时，才会成为众多可能“有效”的比特币地址之一。一旦该地址接受了一笔交易，就会变成全网所知的地址之一，Alice就可以在公开账簿中查询余额了。</p>
<!--Alice和Joe约在当地的一个饭店里会面，正是Joe把比特币介绍给了Alice的。这样Alice就可以用美金向Joe换取一些比特币，让Joe发送一些比特币到她的账户里。她带来了打印版的比特币地址和钱包二维码。从安全角度来说，比特币地址没什么特别机密的。她可以在任何地方公布自己的地址，而不用担心帐户安全。-->

<p>Alice只想兑换10美元的比特币，</p>
<!--
免得在这项新技术上冒险花太多钱。
所以她给了Joe 10美元和她地址的打印件，这样Joe就可以给她发送等值的比特币了。-->

<p>接下来Joe需要弄清楚汇率，以便于发送给Alice相应数额的比特币。</p>
<!--有很多应用和网站都会提供当前的市场汇率，下列是一些最流行的：

**Bitcoin Charts**

Bitcoin Chart 是一个市场数据服务网站，显示了全球众多交易所的比特币市场汇率，以当地不同的汇率来进行结算。

**Bitcoin Average**

Bitcoin Average是一个提供每个币种的交易量加权平均价格的简单视图网站。

**ZeroBlock**
ZeroBlock是一个免费的安卓和iOS应用程序，可以显示不同交易所的比特币价格。（见图1-3）

**Bitcoin Wisdom**
另一个市场数据索引服务站。

![-w320](media/15282733400840.png)
图1-3 ZeroBlock，一款基于安卓和iOS系统的比特币市场汇率应用程序

Joe使用上述的程序或网站中的其中一个，查到比特币的价格约为每个比特币价值100美元左右。按照这个汇率，Alice给了他10美元，作为交换，他应当给Alice 0.1个比特币，即10,000,000聪。
-->

<p>Joe查到一个市场价后，打开自己的手机钱包应用，选择<strong>“发送”比特币</strong>。</p>
<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15282733559784.png" alt="-w320"></p>
<p>图1-4 Blockchain 手机钱包的比特币发送界面</p>
<p>例如，如果是在苹果手机上使用Blockchain手机钱包，他会看见屏幕上要求输入：</p>
<p>▷ <strong>对方的收款地址</strong></p>
<p>▷ <strong>需要发送的比特币数量</strong></p>
<!--
在比特币地址的输入栏，有一个看起来像二维码的小图标。
-->

<p>Joe可以用他的智能手机摄像头扫描条形码，</p>
<!--
而不用再输入Alice的比特币地址(1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK)了，不用再打出这个又长又繁琐的地址。
Joe轻击二维码图标，启动智能手机的摄像头，然后扫描Alice带来的二维码打印版。手机钱包程序会填好比特币地址，Joe可以通过比较这个地址和Alice打印的地址中的几个数字，来确认已正确地扫描。
-->

<p>接着Joe输入了交易的比特币金额，0.1比特币。</p>
<!--
他仔细检查，确保已经输入了正确的金额，因为他马上要发送这些钱了，任何一点点的小失误都会导致发送到错误的地址。最后，他按下了发送键来完成这笔交易。Joe的手机钱包会创建一笔交易，将Joe的钱包里的0.10比特币发送到Alice提供的地址，利用Joe的私钥来签名这笔交易。
-->

<p>这就公告了比特币全网，Joe已经授权允许从他的一个地址转账比特币到Alice的新地址。由于交易是通过P2P网络协议传输，它会迅速在整个比特币网络传播。<br>不到一秒钟，网络中大多数连接良好的节点都会收到该交易信息，并首次公布Alice的地址。</p>
<!--
如果Alice手边有智能手机或笔记本电脑，她也能看到这笔交易。-->

<p>比特币账簿—一个不断膨胀的文件记录，记载了每一笔曾发生过的比特币交易—是公开的，意味着她可以查看所有曾经使用该地址的记录，可以查看是否有人朝这个账户发送了比特币。<br>她只要在blockchain.info网站的搜索框中，输入她自己的地址，就可以轻而易举的知晓了。网页会显示出该地址所有的交易记录。</p>
<!--
Joe点击发送后，0.10比特币会很快转到她的钱包里，如果Alice正看这个页面，她就会发现网页更新了这笔新交易信息。-->

<blockquote>
<p>确认</p>
</blockquote>
<blockquote>
<p>起初，Alice的地址会显示Joe发出这笔的<strong>交易为“未确认”</strong>，这意味着这笔交易已经被广播到网络，但是尚未列入比特币交易记录账簿，即区块链中。</p>
</blockquote>
<blockquote>
<p>总的来说，<strong>交易必须由一个矿工“开采”</strong>，交易是包括在区块中的。当新区块创建时，大约<strong>十分钟</strong>左右，该区域内的交易就会被全网接受为<strong>“已确认”</strong>，区块中的比特币也都能使用。<br>交易可以立即被其他人看到，但只有当其被包含在新开采的区块中，才是“<strong>被信任的</strong>”。</p>
</blockquote>
<!--
现在Alice可以自由支配她所有的0.10个比特币了，感觉很是自豪。
-->

<p>在下一章中，我们将看看她第一次使用比特币支付，并会更细致地了解<br><strong>交易和广播的相关技术</strong>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/06/13/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-001-%E4%BB%8B%E7%BB%8D/" data-id="ckmsza5v100bzow44eljz7op4" data-title="精通比特币-01-介绍" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/精通比特币/2018-03-01-精通比特币（第二版）-000-学习目标" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%89%88%EF%BC%89-000-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/" class="article-date">
  <time class="dt-published" datetime="2018-05-31T10:45:55.000Z" itemprop="datePublished">2018-05-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%89%88%EF%BC%89-000-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/">精通比特币-000-学习目标</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="精通比特币（第二版）"><a href="#精通比特币（第二版）" class="headerlink" title="精通比特币（第二版）"></a><a target="_blank" rel="noopener" href="http://book.8btc.com/books/6/masterbitcoin2cn/_book/">精通比特币（第二版）</a></h2><h3 id="概念-amp-原理"><a href="#概念-amp-原理" class="headerlink" title="概念 &amp; 原理"></a>概念 &amp; 原理</h3><ul>
<li>第一章 介绍</li>
<li>第二章 比特币的原理</li>
</ul>
<h4 id="目标"><a href="#目标" class="headerlink" title="目标:"></a>目标:</h4><ol>
<li>比特币系统的结构及不同节点在系统中的作用</li>
<li>区块链技术在比特币中的应用场景 - 交易流程(UTXO交易模式)、区块的意义</li>
<li>通过比特币客户端的UI进行转账交易（测试网络）</li>
</ol>
<h3 id="私钥、地址创建流程"><a href="#私钥、地址创建流程" class="headerlink" title="私钥、地址创建流程"></a>私钥、地址创建流程</h3><ul>
<li>第四章 私钥 地址 </li>
</ul>
<ol>
<li>私钥-公钥-比特币地址 的概念和转换过程</li>
<li>私钥格式和转换</li>
</ol>
<h4 id="钱包的种类，助记词，种子的概念"><a href="#钱包的种类，助记词，种子的概念" class="headerlink" title="钱包的种类，助记词，种子的概念"></a>钱包的种类，助记词，种子的概念</h4><ul>
<li>第五章 钱包</li>
</ul>
<p><strong>了解：分层确定性钱包（HD钱包）</strong></p>
<ol>
<li>SEED 助记词转换</li>
<li>SEED</li>
<li><ul>
<li>主私钥 - 主公钥 - 链编码 - 索引 - 子私钥关系及构建推导流程</li>
</ul>
</li>
</ol>
<h4 id="目标："><a href="#目标：" class="headerlink" title="目标："></a>目标：</h4><ol>
<li>钱包的概念</li>
<li>私钥、公钥、公钥哈希、地址的类型及概念（压缩、非压缩、对应字节的意义）</li>
<li>通过随机数构建私钥</li>
<li>通过私钥构建公钥、公钥哈希（合法性、ECDSA-secp256k1、Hash160）</li>
<li>通过公钥构建地址 （合法性、Base58Check）</li>
<li>构建P2SH地址</li>
</ol>
<h3 id="钱包对接"><a href="#钱包对接" class="headerlink" title="钱包对接"></a>钱包对接</h3><p>第三章 比特币客户端（BitcoinQT）<br>第五章 交易<br>第六章 比特币网络<br>第七章 区块链</p>
<p><strong>《区块链技术指南》</strong> - 6.1.5 安装和运行比特币测试网络 (代码实战演练)</p>
<p><strong>目标：</strong></p>
<ol>
<li>搭建比特币客户端及JsonRPC的应用（测试网络）</li>
<li>比特币系统支持的交易类型(P2PKH、P2SH）</li>
<li>比特币系统的交易结构（解析后的Json结构的意义、即输入输出、LockTime、序列码）</li>
<li>比特币交易脚本和脚本签名</li>
<li>通过Cli或JsonRPC构建P2PKH、P2SH的原始交易</li>
<li>通过Cli或JsonRPC进行对应交易的签名</li>
<li>通过Cli或JsonRPC广播签名后的交易</li>
<li>通过Cli或JsonRPC验证交易(构建监听服务)</li>
<li>深入了解比特币系统中不同的节点类型及功能</li>
<li>搭建SPV服务节点(Bloom过滤器)</li>
<li>区块结构及内部机制(MerkleTree)</li>
<li>基于MerkleTree解析获取到的区块头实现SPV</li>
</ol>
<p><strong>了解:</strong></p>
<ol>
<li>比特币交易延展性的问题</li>
<li>微支付通道、闪电网络原理（HTLC）</li>
<li>比特币隔离见证的更新内容及实现</li>
<li>比特币分叉后的安全问题</li>
</ol>
<!--
### 共识 & 挖矿程序 （了解）
**精通比特币** - 第八章 挖矿与共识

### 竞争币/比特币安全
第九章 竞争比、竞争块链和应用程序
第十章 比特币安全

### 其他
#### BTC的P2P网络用的什么架构？

比特币采用了基于互联网的去中心化点对点（P2P：peer-to-peer）分布式网络架构。

#### BTC如何完成隔离见证？优点是什么？
#### BTC使用何种文件存储架构？优缺点？
-->
<!--#### 标准交易类型
#### P2PKH
#### P2SH
#### 签名类型（SigHash Type）
#### Sequence number & locktime
#### 交易延展性（Transaction Malleability）
#### 仲裁交易
#### 微支付通道
#### Micropayment Channel
#### 闪电网络
#### Revocable Sequence Maturity Contract（双向）
#### HLTC（哈希锁定）
#### 隔离见证
-->



      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%89%88%EF%BC%89-000-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/" data-id="ckmsza5um00avow44bhlk1zuq" data-title="精通比特币-000-学习目标" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/精通比特币/2018-03-01-精通比特币-000-学习目标" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-000-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/" class="article-date">
  <time class="dt-published" datetime="2018-05-31T10:22:11.000Z" itemprop="datePublished">2018-05-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-000-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/">精通比特币-000-学习目标</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="精通比特币（第二版）"><a href="#精通比特币（第二版）" class="headerlink" title="精通比特币（第二版）"></a><a target="_blank" rel="noopener" href="http://book.8btc.com/books/6/masterbitcoin2cn/_book/">精通比特币（第二版）</a></h2><h3 id="概念-amp-原理"><a href="#概念-amp-原理" class="headerlink" title="概念 &amp; 原理"></a>概念 &amp; 原理</h3><ul>
<li>第一章 介绍</li>
<li>第二章 比特币的原理</li>
</ul>
<h4 id="目标"><a href="#目标" class="headerlink" title="目标:"></a>目标:</h4><ol>
<li>比特币系统的结构及不同节点在系统中的作用</li>
<li>区块链技术在比特币中的应用场景 - 交易流程(UTXO交易模式)、区块的意义</li>
<li>通过比特币客户端的UI进行转账交易（测试网络）</li>
</ol>
<h3 id="私钥、地址创建流程"><a href="#私钥、地址创建流程" class="headerlink" title="私钥、地址创建流程"></a>私钥、地址创建流程</h3><p><strong>精通比特币</strong> - 第四章 私钥 地址 钱包</p>
<h4 id="目标："><a href="#目标：" class="headerlink" title="目标："></a>目标：</h4><ol>
<li>钱包的概念</li>
<li>私钥、公钥、公钥哈希、地址的类型及概念（压缩、非压缩、对应字节的意义）</li>
<li>通过随机数构建私钥</li>
<li>通过私钥构建公钥、公钥哈希（合法性、ECDSA-secp256k1、Hash160）</li>
<li>通过公钥构建地址 （合法性、Base58Check）</li>
<li>构建P2SH地址</li>
</ol>
<p><strong>了解：分层确定性钱包（HD钱包）</strong></p>
<ol>
<li>SEED 助记词转换</li>
<li>SEED  - 主私钥 - 主公钥 - 链编码 - 索引 - 子私钥关系及构建推导流程</li>
</ol>
<h3 id="钱包对接"><a href="#钱包对接" class="headerlink" title="钱包对接"></a>钱包对接</h3><p>第三章 比特币客户端（BitcoinQT）<br>第五章 交易<br>第六章 比特币网络<br>第七章 区块链</p>
<p><strong>《区块链技术指南》</strong> - 6.1.5 安装和运行比特币测试网络 (代码实战演练)</p>
<p><strong>目标：</strong></p>
<ol>
<li>搭建比特币客户端及JsonRPC的应用（测试网络）</li>
<li>比特币系统支持的交易类型(P2PKH、P2SH）</li>
<li>比特币系统的交易结构（解析后的Json结构的意义、即输入输出、LockTime、序列码）</li>
<li>比特币交易脚本和脚本签名</li>
<li>通过Cli或JsonRPC构建P2PKH、P2SH的原始交易</li>
<li>通过Cli或JsonRPC进行对应交易的签名</li>
<li>通过Cli或JsonRPC广播签名后的交易</li>
<li>通过Cli或JsonRPC验证交易(构建监听服务)</li>
<li>深入了解比特币系统中不同的节点类型及功能</li>
<li>搭建SPV服务节点(Bloom过滤器)</li>
<li>区块结构及内部机制(MerkleTree)</li>
<li>基于MerkleTree解析获取到的区块头实现SPV</li>
</ol>
<p><strong>了解:</strong></p>
<ol>
<li>比特币交易延展性的问题</li>
<li>微支付通道、闪电网络原理（HTLC）</li>
<li>比特币隔离见证的更新内容及实现</li>
<li>比特币分叉后的安全问题</li>
</ol>
<!--
### 共识 & 挖矿程序 （了解）
**精通比特币** - 第八章 挖矿与共识

### 竞争币/比特币安全
第九章 竞争比、竞争块链和应用程序
第十章 比特币安全

### 其他
#### BTC的P2P网络用的什么架构？

比特币采用了基于互联网的去中心化点对点（P2P：peer-to-peer）分布式网络架构。

#### BTC如何完成隔离见证？优点是什么？
#### BTC使用何种文件存储架构？优缺点？
-->
<!--#### 标准交易类型
#### P2PKH
#### P2SH
#### 签名类型（SigHash Type）
#### Sequence number & locktime
#### 交易延展性（Transaction Malleability）
#### 仲裁交易
#### 微支付通道
#### Micropayment Channel
#### 闪电网络
#### Revocable Sequence Maturity Contract（双向）
#### HLTC（哈希锁定）
#### 隔离见证
-->



      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-01-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-000-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/" data-id="ckmsza5uo00b4ow4493il9glv" data-title="精通比特币-000-学习目标" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/精通比特币/2018-03-03-精通比特币-003-比特币客户端" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-03-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-003-%E6%AF%94%E7%89%B9%E5%B8%81%E5%AE%A2%E6%88%B7%E7%AB%AF/" class="article-date">
  <time class="dt-published" datetime="2018-05-31T04:17:13.000Z" itemprop="datePublished">2018-05-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-03-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-003-%E6%AF%94%E7%89%B9%E5%B8%81%E5%AE%A2%E6%88%B7%E7%AB%AF/">精通比特币-03-比特币客户端</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="第三章-比特币客户端"><a href="#第三章-比特币客户端" class="headerlink" title="第三章 比特币客户端"></a>第三章 比特币客户端</h3><h4 id="比特币核心"><a href="#比特币核心" class="headerlink" title="比特币核心"></a><a target="_blank" rel="noopener" href="http://book.8btc.com/books/6/masterbitcoin2cn/_book/ch03.html">比特币核心</a></h4><p>Bitcoin是一个开源项目，源代码可以根据开放（MIT）许可证提供，可免费下载并用于任何目的。</p>
<!-- 开源意味着不仅仅是自由使用。 这也意味着比特币是由一个开放的志愿者社区开发的。 起初这个社区只有中本聪。 到2016年，比特币的源代码有超过400个贡献者，大约十几位开发人员几乎全职工作，几十名开发人员兼职。 任何人都可以为代码贡献 - 包括你！

当由中本聪创建比特币时，软件实际上是在后来大名鼎鼎的[satoshi_whitepaper]白皮书之前完成的。 中本聪想在写作之前确保它有效工作。 那么这个第一个实践，就叫做“比特币（Bitcoin）”或者“Satoshi客户”，实际上已经被大大的修改和改进了。

它已经演变成所谓的比特币核心，以区别于其他兼容的实现方式。
-->

<p>比特币核心是比特币系统的参考实现，这意味着它是如何实施的权威参考。</p>
<p><strong>Bitcoin Core实现了比特币的所有方面，包括钱包，交易和区块验证引擎，以及P2P网络中的完整网络节点。</strong></p>
<p>警示： _即使Bitcoin Core包含钱包的参考实现，但这并不意味着可以用作用户或应用程序的生产钱包。</p>
<p>建议应用程序开发人员使用<strong>现代标准（如BIP-39和BIP-32）构建钱包（请参阅助记词]和[hd钱包]章节）</strong>。 BIP就是比特币改进提案（Bitcoin Improvement Proposal）_。</p>
<p>下图为比特币核心的架构。</p>
<p><img src="source/_posts/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/media/15276851790460.jpg"><br>图3-1比特币核心架构（来源Eric Lombrozo）</p>
<h4 id="3-1-比特币开发环境"><a href="#3-1-比特币开发环境" class="headerlink" title="3.1 比特币开发环境"></a>3.1 比特币开发环境</h4><h4 id="3-2-从源码编译比特币核心"><a href="#3-2-从源码编译比特币核心" class="headerlink" title="3.2 从源码编译比特币核心"></a>3.2 从源码编译比特币核心</h4><p>Bitcoin Core的源代码可以作为ZIP存档下载，也可以从GitHub克隆权威的源代码库。 </p>
<!--
在GitHub比特币页面GitHub bitcoin page上，选择“下载ZIP”。 或者，使用git命令行在系统上创建源代码的本地副本。

提示在本章的许多例子中，我们将使用操作系统的命令行界面（也称为“shell”），通过“terminal”应用程序访问。 shell将显示提示你键入命令，并且shell反馈一些文本和一个新的提示您的下一个命令。 提示符可能在您的系统上看起来不同，但在以下示例中，它由符号表示（非用户）。在示例中，当您在符号后面看到文本时，不要键入符号，而是在其后面键入命令，然后按键执行该命令。在示例中，每个命令下面的行是操作系统对该命令的响应。当你看到下一个前缀时，应该继续输入下一个新的命令，可以一直重复这个过程。

在本例中，我们使用git命令来创建源代码的本地副本（“clone”）：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;bitcoin&#x2F;bitcoin.git</span><br><span class="line">Cloning into &#39;bitcoin&#39;...</span><br><span class="line">remote: Counting objects: 66193, done.</span><br><span class="line">remote: Total 66193 (delta 0), reused 0 (delta 0), pack-reused 66193</span><br><span class="line">Receiving objects: 100% (66193&#x2F;66193), 63.39 MiB | 574.00 KiB&#x2F;s, done.</span><br><span class="line">Resolving deltas: 100% (48395&#x2F;48395), done.</span><br><span class="line">Checking connectivity... done.</span><br><span class="line">$</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>提示Git是最广泛使用的分布式版本控制系统，是任何软件开发人员工具包的重要组成部分。 您可能需要在操作系统上安装git命令或git的图形用户界面。<br>–&gt;</p>
<p>当git克隆操作完成后，您将在目录比特币中拥有源代码存储库的完整本地副本。 在提示符下键入“cd bitcoin”，进入为此目录：</p>
<p>$ cd bitcoin</p>
<h5 id="3-2-1-选择比特币核心版本"><a href="#3-2-1-选择比特币核心版本" class="headerlink" title="3.2.1 选择比特币核心版本"></a>3.2.1 选择比特币核心版本</h5><!--默认情况下，本地副本将与最新的代码同步，这可能是不稳定的或Beta版的比特币。 在编译代码之前，先查看一个发布标签tag，选择一个特定的版本。 这将使本地副本与关键字标签所标识的代码库的特定快照同步。 开发人员使用标签来标记版本号的特定版本的代码。 首先，要找到可用的标签，我们使用git tag命令：
-->
<!--
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> $ git tag</span><br><span class="line">v0.1.5</span><br><span class="line">v0.1.6test1</span><br><span class="line">v0.10.0</span><br><span class="line">...</span><br><span class="line">v0.11.2</span><br><span class="line">v0.11.2rc1</span><br><span class="line">v0.12.0rc1</span><br><span class="line">v0.12.0rc2</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;--&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">tag列表显示所有发布的比特币版本。 根据惯例，用于测试的发布候选版本具有后缀“rc”。 可以在生产系统上运行的稳定版本没有后缀。 从上面的列表中，选择最高版本的版本，在编写时是v0.11.2。 要使本地代码与此版本同步，请使用git checkout命令：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ git checkout v0.11.2<br>HEAD is now at 7e27892… Merge pull request #6975</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">您可以通过输入命令git status来确认您有所需的版本“checkout”：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ git status<br>HEAD detached at v0.11.2<br>nothing to commit, working directory clean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> </span><br><span class="line">##### 3.2.2 配置构建比特币核心</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">源代码中包括文档，可以在多个文件中找到。通过在提示符下键入“more README.md”并使用空格键进入下一页，查看bitcoin目录中README.md中的主要文档。在本章中，我们将在Linux上构建命令行比特币客户端，也称为比特币（bitcoind）。在系统中查看编译bitcoind命令行客户端的说明，方法是输入“more doc &#x2F; build-unix.md” 。可以在doc目录中找到macOS和Windows的替代说明，分别为build-osx.md或build-windows.md。</span><br><span class="line"></span><br><span class="line">仔细查看build前提条件，这些前提是build文档的第一部分。这些是在您开始编译比特币之前必须存在于系统上的库。如果缺少这些先决条件，build过程将失败并显示错误。如果发生这种情况是因为您缺失先决条件，则可以安装它，然后从您所在的地方恢复build过程。假设安装了先决条件，您可以通过使用autogen.sh脚本生成一组build脚本来启动build过程。</span><br><span class="line"></span><br><span class="line">注意Bitcoin Core build过程已经从0.9开始更改为使用autogen &#x2F; configure &#x2F; make系统。 旧版本使用简单的Makefile，与以下示例的方法略有不同。 因此要按照要编译的版本的说明进行操作。 在0.9中引入的autogen &#x2F; configure &#x2F; make可能是用于所有未来版本代码的build系统，并且是以下示例中演示的系统。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ ./autogen.sh<br>…<br>glibtoolize: copying file ‘build-aux/m4/libtool.m4’<br>glibtoolize: copying file ‘build-aux/m4/ltoptions.m4’<br>glibtoolize: copying file ‘build-aux/m4/ltsugar.m4’<br>glibtoolize: copying file ‘build-aux/m4/ltversion.m4’<br>…<br>configure.ac:10: installing ‘build-aux/compile’<br>configure.ac:5: installing ‘build-aux/config.guess’<br>configure.ac:5: installing ‘build-aux/config.sub’<br>configure.ac:9: installing ‘build-aux/install-sh’<br>configure.ac:9: installing ‘build-aux/missing’<br>Makefile.am: installing ‘build-aux/depcomp’<br>…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">autogen.sh脚本创建一组自动配置脚本，它会询问系统以发现正确的设置，并确保您拥有编译代码所需的所有库。 其中最重要的是配置脚本，它提供了许多不同的选项来自定义构建过程。 键入“.&#x2F;configure --help”查看各种选项：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ ./configure –help<br>`configure’ configures Bitcoin Core 0.11.2 to adapt to many kinds of systems.</p>
<p>Usage: ./configure [OPTION]… [VAR=VALUE]…</p>
<p>…<br>Optional Features:<br>  –disable-option-checking  ignore unrecognized –enable/–with options<br>  –disable-FEATURE       do not include FEATURE (same as –enable-FEATURE=no)<br>  –enable-FEATURE[=ARG]  include FEATURE [ARG=yes]</p>
<p>  –enable-wallet         enable wallet (default is yes)</p>
<p>  –with-gui[=no|qt4|qt5|auto]<br>…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">配置脚本允许您通过使用--enable-FEATURE和--disable-FEATURE标志来启用或禁用bitcoind的某些功能，其中FEATURE由功能名称替换，如帮助输出中所列。 在本章中，我们将构建具有所有默认功能的bitcoind客户端。 我们不会使用配置标志，但您应该查看它们以了解可选功能是客户端的一部分。 如果您处于学术环境中，计算机实验室的限制可能需要您在主目录中安装应用程序（例如，使用--prefix &#x3D; $ HOME）。</span><br><span class="line"></span><br><span class="line">以下是一些有用的选项，可以覆盖configure脚本的默认行为：</span><br><span class="line"></span><br><span class="line">--prefix&#x3D;$HOME</span><br><span class="line"></span><br><span class="line">这将覆盖生成的可执行文件的默认安装位置（它是&#x2F; usr &#x2F; local &#x2F;）。 使用$ HOME将所有内容放在您的主目录或不同的路径中。</span><br><span class="line"></span><br><span class="line">--disable-wallet</span><br><span class="line"></span><br><span class="line">这用于禁用参考钱包的实现。</span><br><span class="line"></span><br><span class="line">--with-incompatible-bdb</span><br><span class="line"></span><br><span class="line">如果您正在构建钱包，请允许使用不兼容版本的Berkeley DB库。</span><br><span class="line"></span><br><span class="line">--with-gui&#x3D;no</span><br><span class="line"></span><br><span class="line">不要构建图形用户界面，图形界面需要Qt库。 这只构建服务器和命令行。</span><br><span class="line"></span><br><span class="line">接下来，运行configure脚本来自动发现所有必需的库，并为您的系统创建一个自定义的构建脚本：</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ ./configure<br>checking build system type… x86_64-unknown-linux-gnu<br>checking host system type… x86_64-unknown-linux-gnu<br>checking for a BSD-compatible install… /usr/bin/install -c<br>checking whether build environment is sane… yes<br>checking for a thread-safe mkdir -p… /bin/mkdir -p<br>checking for gawk… gawk<br>checking whether make sets $(MAKE)… yes<br>…<br>[many pages of configuration tests follow]<br>…<br>$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果一切顺利，configure命令将会以创建可定制的构建脚本结束。这些构建脚本允许我们编译bitcoind。如果有缺失的库或是错误，configure命令将会以错误信息终止。如果出现了错误，可能是因为缺少库或是有不兼容的库。重新检查构建文档，确认你已经安装缺失的必备条件。然后运行configure，看看错误是否消失了。</span><br><span class="line"></span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">##### 3.2.3 构建Bitcoin核心可执行文件</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">下一步，你将编译源代码，这个过程根据CPU和内存资源不同，但一般可能需要1个小时完成。在编译的过程中，你应该过几秒或是几分钟看一下输出结果。如果出现了问题，你会看到错误。如果中断了，编译的过程可以在任何时候恢复。输入make命令就可以开始编译了：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ make<br>Making all in src<br>  CXX      crypto/libbitcoinconsensus_la-hmac_sha512.lo<br>  CXX      crypto/libbitcoinconsensus_la-ripemd160.lo<br>  CXX      crypto/libbitcoinconsensus_la-sha1.lo<br>  CXX      crypto/libbitcoinconsensus_la-sha256.lo<br>  CXX      crypto/libbitcoinconsensus_la-sha512.lo<br>  CXX      libbitcoinconsensus_la-hash.lo<br>  CXX      primitives/libbitcoinconsensus_la-transaction.lo<br>  CXX      libbitcoinconsensus_la-pubkey.lo<br>  CXX      script/libbitcoinconsensus_la-bitcoinconsensus.lo<br>  CXX      script/libbitcoinconsensus_la-interpreter.lo</p>
<p>[… many more compilation messages follow …]</p>
<p>$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果一切顺利，bitcoind现在已经编译完成。最后一步就是通过sudo make install 命令，安装 bitcoind 可执行文件到你的系统路径下，可能会提示您输入用户密码，因为此步骤需要管理员权限：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ sudo make install<br>Password:<br>Making install in src<br> ../build-aux/install-sh -c -d ‘/usr/local/lib’<br>libtool: install: /usr/bin/install -c bitcoind /usr/local/bin/bitcoind<br>libtool: install: /usr/bin/install -c bitcoin-cli /usr/local/bin/bitcoin-cli<br>libtool: install: /usr/bin/install -c bitcoin-tx /usr/local/bin/bitcoin-tx<br>…<br>$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">bitcoind 默认的安装位置是&#x2F;usr&#x2F;local&#x2F;bin。你可以通过询问系统下面2个可执行文件的路径，来确认bitcoin是否安装成功</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ which bitcoind<br>/usr/local/bin/bitcoind</p>
<p>$ which bitcoin-cli<br>/usr/local/bin/bitcoin-cli</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">##### 3.2.4 运行比特币核心节点</span><br><span class="line"></span><br><span class="line">##### 3.2.5 首次运行比特币核心</span><br><span class="line"></span><br><span class="line">##### 3.2.6 配置比特币核心节点</span><br><span class="line"></span><br><span class="line">#### 3.3 通过命令行使用比特币核心的JSON-PRC API接口</span><br><span class="line"></span><br><span class="line">比特币核心客户端实现了JSON-RPC接口，这个接口也可以通过命令行帮助程序bitcoin-cli访问。命令行可以使用API进行编程，让我们有能力进行交互实验。开始前，调用help命令查看可用的比特币RPC命令列表：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ bitcoin-cli help<br>addmultisigaddress nrequired [“key”,…] ( “account” )<br>addnode “node” “add|remove|onetry”<br>backupwallet “destination”<br>createmultisig nrequired [“key”,…]<br>createrawtransaction [{“txid”:”id”,”vout”:n},…] {“address”:amount,…}<br>decoderawtransaction “hexstring”<br>…<br>…<br>verifymessage “bitcoinaddress” “signature” “message”<br>walletlock<br>walletpassphrase “passphrase” timeout<br>walletpassphrasechange “oldpassphrase” “newpassphrase”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这些命令中的每一个可能需要多个参数。 要获得更多帮助，详细说明和参数信息，请在帮助后添加命令名称。 例如，要查看getblockhash RPC命令的帮助：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ bitcoin-cli help getblockhash<br>getblockhash index</p>
<p>Returns hash of block in best-block-chain at index provided.</p>
<p>Arguments:</p>
<ol>
<li>index         (numeric, required) The block index</li>
</ol>
<p>Result:<br>“hash”         (string) The block hash</p>
<p>Examples:</p>
<blockquote>
<p>bitcoin-cli getblockhash 1000<br>curl –user myusername –data-binary ‘{“jsonrpc”: “1.0”, “id”:”curltest”, “method”: “getblockhash”, “params”: [1000] }’ -H ‘content-type: text/plain;’ <a target="_blank" rel="noopener" href="http://127.0.0.1:8332/">http://127.0.0.1:8332/</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在帮助信息的最后，您将看到RPC命令的两个示例，使用bitcoin-cli helper或HTTP客户端的curl。 这些例子演示如何调用命令。 复制第一个示例并查看结果：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ bitcoin-cli getblockhash 1000<br>00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">结果是一个区块哈希，这在下面的章节中有更详细的描述。 但是现在，该命令应该在您的系统上返回相同的结果，表明您的Bitcoin Core节点正在运行，正在接受命令，并且有关于块1000的信息返回给您。</span><br><span class="line"></span><br><span class="line">在下一节中，我们将演示一些非常有用的RPC命令及其预期输出。</span><br><span class="line"></span><br><span class="line">##### 3.3.1 获得比特币核心客户端状态的信息</span><br><span class="line"></span><br><span class="line">命令：getinfo</span><br><span class="line"></span><br><span class="line">比特币 getinfo RPC命令显示关于比特币网络节点、钱包、区块链数据库状态的基础信息。使用 bitcoin-cli 运行它：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ bitcoin-cli getinfo<br>{<br>    “version” : 110200,<br>    “protocolversion” : 70002,<br>    “blocks” : 396367,<br>    “timeoffset” : 0,<br>    “connections” : 15,<br>    “proxy” : “”,<br>    “difficulty” : 120033340651.23696899,<br>    “testnet” : false,<br>    “relayfee” : 0.00010000,<br>    “errors” : “”<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">数据以JavaScript对象表示法（JSON）返回，这是一种格式，可以轻松地被所有编程语言“消费”，但也是非常人性化的。 在这些数据中，我们看到比特币软件客户端（110200）和比特币协议（70002）的版本号。 我们看到当前的块高度，显示了这个客户端知道了多少块（396367）。 我们还会看到有关比特币网络和与此客户端相关的设置的各种统计信息。</span><br><span class="line"></span><br><span class="line">提示 比特币特客户端“赶上”当前的blockchain高度需要一些时间，因为它从其他bitcoin客户端下载块。 您可以使用getinfo检查其进度，以查看已知块的数量。</span><br><span class="line"></span><br><span class="line">###### 3.3.1.1 探索和解码交易</span><br><span class="line"></span><br><span class="line">命令：getrawtransaction， decoderawtransaction</span><br><span class="line"></span><br><span class="line">在买咖啡的故事中，Alice从Bob咖啡厅买了一杯咖啡。 她的交易记录在交易ID（txid）0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2的封锁上。 我们使用API通过传递交易ID作为参数来检索和检查该交易：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ bitcoin-cli getrawtransaction 0627052b6f28912f2703066a912ea577f2ce4da4caa5a↵<br>5fbd8a57286c345c2f2</p>
<p>0100000001186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd734d2804fe65fa35779000↵<br>000008b483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4↵<br>ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813014↵<br>10484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc54123363767↵<br>89d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adfffffffff0260e3160000000↵<br>0001976a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef8000000000001976a9↵<br>147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac00000000</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">提示交易ID在交易被确认之前不具有权威性。 在区块链中缺少交易哈希并不意味着交易未被处理。 这被称为“交易可扩展性”，因为在块中确认之前可以修改交易哈希。 确认后，txid是不可改变的和权威的。</span><br><span class="line"></span><br><span class="line">命令getrawtransaction以十六进制返回顺序交易。 为了解码，我们使用decodeawtransaction命令，将十六进制数据作为参数传递。 您可以复制getrawtransaction返回的十六进制，并将其作为参数粘贴到decodeawtransaction中：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ bitcoin-cli decoderawtransaction 0100000001186f9f998a5aa6f048e51dd8419a14d8↵<br>a0f1a8a2836dd734d2804fe65fa35779000000008b483045022100884d142d86652a3f47ba474↵<br>6ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298↵<br>cad530a863ea8f53982c09db8f6e381301410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fd↵<br>e0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa↵<br>336a8d752adfffffffff0260e31600000000001976a914ab68025513c3dbd2f7b92a94e0581f5↵<br>d50f654e788acd0ef8000000000001976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8↵<br>88ac00000000</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>{<br>  “txid”: “0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2”,<br>  “size”: 258,<br>  “version”: 1,<br>  “locktime”: 0,<br>  “vin”: [<br>    {<br>      “txid”: “7957a35fe64f80d234d76d83a2…8149a41d81de548f0a65a8a999f6f18”,<br>      “vout”: 0,<br>      “scriptSig”: {<br>        “asm”:”3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1decc…”,<br>        “hex”:”483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1de…”<br>      },<br>      “sequence”: 4294967295<br>    }<br>  ],<br>  “vout”: [<br>    {<br>      “value”: 0.01500000,<br>      “n”: 0,<br>      “scriptPubKey”: {<br>        “asm”: “OP_DUP OP_HASH160 ab68…5f654e7 OP_EQUALVERIFY OP_CHECKSIG”,<br>        “hex”: “76a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788ac”,<br>        “reqSigs”: 1,<br>        “type”: “pubkeyhash”,<br>        “addresses”: [<br>          “1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA”<br>        ]<br>      }<br>    },<br>    {<br>      “value”: 0.08450000,<br>      “n”: 1,<br>      “scriptPubKey”: {<br>        “asm”: “OP_DUP OP_HASH160 7f9b1a…025a8 OP_EQUALVERIFY OP_CHECKSIG”,<br>        “hex”: “76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac”,<br>        “reqSigs”: 1,<br>        “type”: “pubkeyhash”,<br>        “addresses”: [<br>          “1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK”<br>        ]<br>      }<br>    }<br>  ]<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">交易解码展示这笔交易的所有成分，包括交易的输入及输出。在这个例子中，我们可以看到这笔给我们新地址存入 50mBTC的交易使用了一个输入并且产生两个输出。这笔交易的输入是前一笔确认交易的输出（展示位以d3c7开头的 vin txid）。两个输出则是50mBTC存入额度及返回给发送者的找零。</span><br><span class="line"></span><br><span class="line">我们可以使用相同命令（例如 gettransaction ）通过检查由本次交易的txid索引的前一笔交易进一步探索区块链。通过从 一笔交易跳到另外一笔交易，我们可以追溯一连串的交易，因为币值一定是从一个拥有者的地址传送到另一个拥有者的地址。</span><br><span class="line"></span><br><span class="line">##### 3.3.2 探索区块</span><br><span class="line"></span><br><span class="line">命令：getblock、getblockhash</span><br><span class="line"></span><br><span class="line">探索区块类似于探索交易。 但是，块可以由块高度或块哈希引用。 首先，让我们找到一个块的高度。 在买咖啡故事中，我们看到Alice的交易已被包含在框277316中。我们使用getblockhash命令，它将块高度作为参数，并返回该块的块哈希值：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ bitcoin-cli getblockhash 277316<br>0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">既然我们知道我们的交易在哪个区块中，我们可以使用getblock命令，并把区块哈希值作为参数来查询对应的区块：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ bitcoin-cli getblock 0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b3↵<br>1b2cc7bdc4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>{<br>  “hash”: “0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4”,<br>  “confirmations”: 37371,<br>  “size”: 218629,<br>  “height”: 277316,<br>  “version”: 2,<br>  “merkleroot”: “c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e”,<br>  “tx”: [<br>    “d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f”,<br>    “b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe”,<br>    “04905ff987ddd4cfe603b03cfb7ca50ee81d89d1f8f5f265c38f763eea4a21fd”,<br>    “32467aab5d04f51940075055c2f20bbd1195727c961431bf0aff8443f9710f81”,<br>    “561c5216944e21fa29dd12aaa1a45e3397f9c0d888359cb05e1f79fe73da37bd”,<br>[… hundreds of transactions …]<br>    “78b300b2a1d2d9449b58db7bc71c3884d6e0579617e0da4991b9734cef7ab23a”,<br>    “6c87130ec283ab4c2c493b190c20de4b28ff3caf72d16ffa1ce3e96f2069aca9”,<br>    “6f423dbc3636ef193fd8898dfdf7621dcade1bbe509e963ffbff91f696d81a62”,<br>    “802ba8b2adabc5796a9471f25b02ae6aeee2439c679a5c33c4bbcee97e081196”,<br>    “eaaf6a048588d9ad4d1c092539bd571dd8af30635c152a3b0e8b611e67d1a1af”,<br>    “e67abc6bd5e2cac169821afc51b207127f42b92a841e976f9b752157879ba8bd”,<br>    “d38985a6a1bfd35037cb7776b2dc86797abbb7a06630f5d03df2785d50d5a2ac”,<br>    “45ea0a3f6016d2bb90ab92c34a7aac9767671a8a84b9bcce6c019e60197c134b”,<br>    “c098445d748ced5f178ef2ff96f2758cbec9eb32cb0fc65db313bcac1d3bc98f”<br>  ],<br>  “time”: 1388185914,<br>  “mediantime”: 1388183675,<br>  “nonce”: 924591752,<br>  “bits”: “1903a30c”,<br>  “difficulty”: 1180923195.258026,<br>  “chainwork”: “000000000000000000000000000000000000000000000934695e92aaf53afa1a”,<br>  “previousblockhash”: “0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569”,<br>  “nextblockhash”: “000000000000000010236c269dd6ed714dd5db39d36b33959079d78dfd431ba7”<br>}</p>
<pre><code>
##### 3.3.3 使用比特币核心的编程接口

#### 3.4 其他替代客户端、资料库、工具包
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/05/31/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-03-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-003-%E6%AF%94%E7%89%B9%E5%B8%81%E5%AE%A2%E6%88%B7%E7%AB%AF/" data-id="ckmsza5uy00bwow44871u16oj" data-title="精通比特币-03-比特币客户端" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/精通比特币/2018-03-10-精通比特币-010-比特币安全 6" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/24/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-10-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-010-%E6%AF%94%E7%89%B9%E5%B8%81%E5%AE%89%E5%85%A8%206/" class="article-date">
  <time class="dt-published" datetime="2018-05-24T04:43:07.000Z" itemprop="datePublished">2018-05-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/24/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-10-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-010-%E6%AF%94%E7%89%B9%E5%B8%81%E5%AE%89%E5%85%A8%206/">精通比特币-10-比特币安全</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="第十章-比特币安全"><a href="#第十章-比特币安全" class="headerlink" title="第十章 比特币安全"></a>第十章 比特币安全</h3><!--
保护比特币是很具有挑战性的事，因为比特币不像银行账户余额那样体现抽象价值。比特币其实更像数字现金或黄金。你可能听过这样的说法，“现实持有，败一胜九。”好吧，在比特币的世界里，这样的持有只能让你有一成胜率。而只有拥有解锁比特币的密钥才相当于持有现金或一块贵重金属。你可能会将密钥丢失，会放错地方，会被盗或者不小心错支了数额。无论是哪种场景，用户都没有办法撤回，因为这就像是将现金丢在了车水马龙的大街上。
不过，与现金、黄金或者银行账户相比，比特币有着一个独一无二的优势。
-->

<p>你不能“备份”你的现金、黄金或者银行账户，但你可以像备份其他文件一样，<strong>备份含有密钥的比特币钱包</strong>。</p>
<!--
它可以被复制成很多份，放到不同的地方保存起来，甚至能打印到纸上进行实体备份。比特币与至今为止的其他货币是如此不同，以致于我们需要以一种全新的思维方式来衡量比特币的安全性。
-->

<h4 id="10-1-安全准则"><a href="#10-1-安全准则" class="headerlink" title="10.1 安全准则"></a>10.1 安全准则</h4><p>比特币的核心准则是去中心化，这一点对安全性具有重要意义。</p>
<!--在中心化的模式下，例如传统的银行或支付网络，需要依赖于访问控制和审查制度将不良行为者拒之门外。相比之下，比特币这样的去中心化系统则将责任和控制权都移交给了用户。

由于网络的安全性是基于工作量证明而非访问控制，比特币网络可以对所有人开放，也无需对比特币流量进行加密。

在一个传统的支付网络中，例如信用卡系统，支付是终端开放式的，因为它包含了用户的个人标识（信用卡号）。在初次支付后，任何能获得该标识的人都可以从所有者那里反复“提取”资金。因此，该支付网络必须采取端对端加密的方式，以确保没有窃听者或中间人可以在资金流通或存储过程中将交易数据截获。如果坏人获得该系统的控制权，他将能破获破获当前的的交易和支付令牌，他还可以随意动用这笔资金。更糟的是，当客户数据被泄露时，顾客的个人身份信息将被盗窃者们一览无余。客户这时必须立即采取措施，以防失窃帐户被盗窃者用于欺诈。

比特币则截然不同，
-->

<p>一笔比特币交易只授权向指定接收方发送一个指定数额，并且不能被修改或伪造。</p>
<!--
它不会透露任何个人信息，例如当事人的身份，也不能用于权限外的支付。因此，比特币的支付网络并不需要加密或防窃听保护。事实上，你可以在任何公开的网络上广播比特币交易的数据，例如在不安全的WiFi或蓝牙网络上公开传播比特币交易的数据，这对安全性没有任何影响。
-->

<p>比特币的去中心化安全模型很大程度上将权力移交到<strong>用户</strong>手上，随之而来的是用户们<strong>保管好密钥的责任</strong>。</p>
<!--
这对于大多数用户来说并非一件易事，特别是在像智能手机或笔记本电脑这种能能时刻联网的通用设备上。虽然比特币的去中心化模型避免了常见的信用卡盗用等情况，但很多用户由于无法保管好密钥从而被黑客攻击。
-->

<h5 id="10-1-1-比特币系统安全开发"><a href="#10-1-1-比特币系统安全开发" class="headerlink" title="10.1.1 比特币系统安全开发"></a>10.1.1 比特币系统安全开发</h5><p>对于比特币开发者而言最重要的是去中心化原则。</p>
<!--
大多数开发者对中心化的安全模型很熟悉，并可能试图将中心化的模型运用到借鉴比特币的应用中去去，这将给比特币带来灭顶之灾。
-->

<p>比特币的安全性依赖于密钥的分散性控制，<br>并且需要矿工们各自独立地进行交易验证。</p>
<!--
如果你想利用好比特币的安全性，你需要确保自己处于比特币的安全模型里。简而言之，不要将用户的密钥控制权拿走，不要接受非区块链交易信息。

例如，许多早期的比特币交易所将所有用户的资金集中在一个包含着私钥的“热钱包”里，并存放在服务器上。

这样的设计夺取了用户的掌控权，并将密钥集中到单个系统里。很多这样的系统都被黑客攻破了，并给客户带来灾难性后果。
-->

<p>另一个常见的错误是接受区块链离线交易，妄图减少交易费或加速交易处理速度。</p>
<!--
一个“区块链离线交易”系统将交易数据记录在一个内部的中心化账本上，然后偶尔将它们同步到比特币区块链中。这种做法，再一次，用专制和集中的方式取代比特币的去中心化安全模型。当数据处于离线的区块链上的时候，保护不当的中心化账本里的资金可能会不知不觉被伪造、被挪用、被消耗。

除非你是准备大力投资运营安全，叠加多层访问控制，或（像传统的银行那样）加强审计，否则在将资金从比特币的去中心化安全场景中抽离出来之前，你应该慎重考虑一番。即使你有足够的资金和纪律去实现一个可靠的安全模型，这样的设计也仅仅是复制了一个脆弱不堪，深受账户盗窃威胁、贪污和挪用公款困扰的传统金融网络而已。要想充分利用比特币特有的去中心化安全模型，你必须避免中心化架构的常见诱惑，因它最终将摧毁比特币的安全性。
-->

<h5 id="10-1-2-信任根源"><a href="#10-1-2-信任根源" class="headerlink" title="10.1.2 信任根源"></a>10.1.2 信任根源</h5><p><strong>传统的安全体系</strong>基于一个称为<strong>信任根源</strong>的概念，它指的总体系统或应用程序中一个可信赖的安全核心。</p>
<!--
安全体系像一圈同心圆一样围绕着信任根源来进行开发，像层层包裹的洋葱一样，信任从内至外依次延伸。每一层都构建于更可信的内层之上，通过访问控制，数字签名，加密和其他安全方式确保可信。随着软件系统变得越来越复杂，它们更可能出现问题，安全更容易受到威胁。其结果是，软件系统变得越复杂，就越难维护安全性。信任根源的概念确保绝大多数的信任被置于系统一个不是过于复杂的部分，因此该系统的这部分也相对坚固，而更复杂的软件则在它之上构建。这样的安全体系随着规模扩大而不断重复出现，首先信任根源建立于单个系统的硬件内，然后将该信任根源通过操作系统扩展到更高级别的系统服务，最后逐次扩散到圈内多台服务器上。

比特币的安全体系与这不同。
-->

<p>在比特币里，共识系统创建了一个可信的完全<strong>去中心化的公开账本</strong>，一个正确验证过的区块使用<strong>创世块</strong>作为信任的根源，建立一条直至当前区块的<strong>可信任链</strong>。</p>
<p>比特币系统可以并应该使用<strong>区块链</strong>作为它们的信任根源。</p>
<!--在设计一个多系统服务机制的比特币应用时，你应该仔细确认安全体系，以确保对它的信任能有据可依。

最终，唯一可确信无疑的是一条完全有效的区块链。如果你的应用程序或明或暗地信赖于区块链以外的东西，就该引起重视，因为它可能会引入漏洞。

一个不错的方法评估你应用程序的安全体系：单独考量每个组件，设想该组件被完全攻破并被坏人掌控的场景。依次取出应用程序的每个组件，并评估它被攻破时对整体安全的影响。如果你的应用程序的安全性在该组件沦陷后大打折扣，那就说明你已经对这些组件过度信任了。-->

<p>一个没有漏洞的比特币应用程序应该<strong>只受限于比特币的共识机制</strong>，这意味着其安全体系的信任源于比特币最坚固的部分。</p>
<!--
无数个黑客攻击比特币交易所的例子都是因为轻视了这一点，他们的安全体系和设计甚至无法通过基本的审查。

这种中心化的实现方式将信任置于比特币区块链之外的诸多组件之上，例如热钱包，中心化的账本数据库，简易加密的密钥，以及许多类似的方案。-->

<h4 id="10-2-用户最佳安全实践"><a href="#10-2-用户最佳安全实践" class="headerlink" title="10.2 用户最佳安全实践"></a>10.2 用户最佳安全实践</h4><!--
人类使用物理的安全控制已经有数千年之久。相比之下，我们的数字化安全经验的年纪还不满50岁。

现代通用的操作系统并不是十分安全，亦不特别适合用来存储数字货币。我们的电脑通过一直连接的互联网长时间暴露在外，它们运行着成千上万第三方软件组件，这些软件往往可以不受约束地访问用户的文件。

你电脑上安装的众多软件只要有一个恶意软件，就会威胁到你的文件，可窃取你钱包里的所有比特币。想要杜绝病毒和木马对电脑的威胁，用户要达到一定的计算机维护水平，只有小部分人能做到。

尽管信息安全经过了数十年的研究和发展，数字资产在绵延不绝的攻势下还是十分脆弱。纵使是像金融服务公司，情报机构或国防承包商这样拥有高度防护和限制的系统，也经常会被攻破。

比特币创造了具有内在价值的数字资产，它可以被窃取，并立即转移给他人而无法撤回。这让黑客有了强烈的作案动机。

至今为止，黑客都不得不在套现后更换身份信息或帐户口令，例如信用卡或银行账户。尽管掩饰和洗白这部分财务信息的难度不小，但越来越多的窃贼从于此道。而比特币使这个问题加剧了，因为它不需要掩饰或洗白，它本身就是具有内在价值的数字资产。

幸运的是，比特币也有着激励机制，以提高计算机的安全性。如前所述，计算机受威胁的风险是模糊的，间接的，而比特币让这些风险变得明确清晰。在电脑上保存比特币让用户时刻注意他们需要提高计算机的安全性，结果便是这使得比特币和其它数字货币得以传播和扩散，我们已经看到在黑客技术和安全解决方案双方的提升。简单来说，黑客现在有着一个非常诱人的目标，而用户也有明确的激励性去保卫自己。

在过去的三年里，随着比特币不断被接纳，一个直接的结果是，
-->

<p>我们已经看到信息安全领域取得了巨大创新，例如<strong>硬件加密，密钥存储和硬件钱包，多重签名技术和数字托管</strong>。</p>
<!--
在下面的章节中，我们将研究各种实际用户安全中的实践经验。
-->

<h5 id="10-2-1-比特币物理存储"><a href="#10-2-1-比特币物理存储" class="headerlink" title="10.2.1 比特币物理存储"></a>10.2.1 比特币物理存储</h5><!--
相比数字信息的安全，大多数用户对物理安全更加熟悉，一个非常有效保护比特币的方法是，将它们转换为物理形式。
-->

<p><strong>比特币密钥</strong>不过是串长数字而已。</p>
<!--
这意味着它们可以以物理形式存储起来，如印在纸上或蚀刻成金属硬币上。这样保护密钥就变成了简单地保护印着比特币密钥的物理实体。一组打印在纸上的比特币密钥被称为“纸钱包”，有许多可以用来创建它们的免费工具。我个人将大部分（99％ 以上）的比特币存储在纸钱包上，并用 BIP0038 加密，复制了多份并锁在保险箱里。
-->

<p><strong>将比特币离线保存被称为冷存储</strong>，它是最有效的安全技术之一。</p>
<p>冷存储系统是在一个<strong>离线系统</strong>（一个从来没有连接过互联网的系统）上<strong>生成密钥</strong>，并离线存储到纸上或者 U 盘等电子媒介。</p>
<h5 id="10-2-2-硬件钱包"><a href="#10-2-2-硬件钱包" class="headerlink" title="10.2.2 硬件钱包"></a>10.2.2 硬件钱包</h5><!--从长远来看，比特币安全将越来越多地以硬件防篡改钱包的形式出现。与智能手机或台式电脑不同，-->

<p>一个比特币硬件钱包只有一个目的，<strong>安全地存储比特币</strong>。</p>
<!--
不像容易受害的常用软件那样，硬件钱包只提供了有限的接口，从而可以给非专业用户提供近乎万无一失的安全等级。

我预期将看到硬件钱包成为比特币储存的主要方式。
-->

<p>要想看硬件钱包的实例，请查阅 <strong>Trezor</strong>。</p>
<h5 id="10-2-3-平衡风险"><a href="#10-2-3-平衡风险" class="headerlink" title="10.2.3 平衡风险"></a>10.2.3 平衡风险</h5><!--
虽然大多数用户都非常关注比特币防盗，其实还有一个更大的风险存在。数据文件丢失的情况时有发生。如果比特币的数据也在其中，损失将会让人痛苦不堪。为了保护好比特币钱包，用户必须非常注意不要剑走偏锋，这样不至于会搞丢比特币。在2011年7月，一个著名的比特币认知教育项目损失了近7,000枚比特币。为了防止被盗窃，其主人曾之前采取了一系列复杂的操作去加密备份。结果他们不慎丢失了加密的密钥，使得备份变得毫无价值，白白失去了一大笔财富。如果你保护比特币的方式太过了，这好比于把钱藏在沙漠里，你可能不能再把它找回来了。-->

<h5 id="10-2-4-分散风险"><a href="#10-2-4-分散风险" class="headerlink" title="10.2.4 分散风险"></a>10.2.4 分散风险</h5><!--
你会将你的全部家当换成现金放在钱包里随身携带么？大多数人会认为这非常不明智，但比特币用户经常会将所有的比特币放在一个钱包里。用户应该将风险分散到不同类型的比特币钱包。


审慎的用户应该只留一小部分（或许低于5%）的比特币在一个在线的或手机钱包，就像零用钱一样，其余的部分应该采用不同存储机制分散开来，诸如电脑钱包和离线（冷存储）钱包。
-->

<h5 id="10-2-5-多重签名管理"><a href="#10-2-5-多重签名管理" class="headerlink" title="10.2.5 多重签名管理"></a>10.2.5 多重签名管理</h5><!--
当一个公司或个人持有大量比特币时，他们应该考虑采用多重签名的比特币地址。
-->

<p><strong>多重签名比特币地址需要多个签名才能支付，从而保证资金的安全。</strong></p>
<p><em>多重签名的密钥应存储在多个不同的地方，并由不同的人掌控。</em></p>
<!--
打个比方，在企业环境中，密钥应该分别生成并由若干公司管理人员持有，以确保没有任何一个人可以独自占有资金。

多重签名的地址也可以提供冗余，例如一个人持有多个密钥，并将它们分别存储在不同的地方。
-->

<h5 id="10-2-6-存活能力"><a href="#10-2-6-存活能力" class="headerlink" title="10.2.6 存活能力"></a>10.2.6 存活能力</h5><!--
一个非常重要却又常常被忽视的安全性考虑是可用性，尤其是在密钥持有者丧失工作能力或死亡的情况下。

比特币的用户被告知应该使用复杂的密码，并保证他们的密钥安全且不为他人所知。

不幸的是，这种做法使得在用户无法解锁时，用户的家人几乎无法将该财产恢复。

事实上，比特币用户的家人可能完全不知道这笔比特币资金的存在。

如果你有很多的比特币，你应该考虑与一个值得信赖的亲属或律师分享解密的细节。
-->

<p>一个更复杂的比特币生还计划，<strong>可以通过设置多重签名，</strong>做好遗产规划，并通过专门的“数字资产执行者”律师处理后事。</p>
<h4 id="10-3-总结"><a href="#10-3-总结" class="headerlink" title="10.3 总结"></a>10.3 总结</h4><p>比特币是一项全新的，前所未有的，复杂的技术。</p>
<!--
随着时间的推移，我们将开发出更好的安全工具，而且更容易被非专业人士使用的做法。而现在，比特币用户可以使用许多这里所讨论的技巧，享受安全而无困扰的比特币生活。
-->



      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/05/24/Bitcoin/%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81/2018-03-10-%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81-010-%E6%AF%94%E7%89%B9%E5%B8%81%E5%AE%89%E5%85%A8%206/" data-id="ckmsza5uu00biow44d8sn8p1v" data-title="精通比特币-10-比特币安全" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/比特币源码解析/2018-04-20-比特币源码解析-08-可执行程序-Bitcoind" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/10/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-08-%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F-Bitcoind/" class="article-date">
  <time class="dt-published" datetime="2018-05-10T04:01:05.000Z" itemprop="datePublished">2018-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/10/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-08-%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F-Bitcoind/">比特币源码解析-可执行程序-Bitcoind</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="01-AppInit"><a href="#01-AppInit" class="headerlink" title="01 AppInit"></a>01 AppInit</h3><p>AppInit()是main函数中的最后一个函数:</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/05/10/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-08-%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F-Bitcoind/" data-id="ckmsza5w000cqow445eu6di31" data-title="比特币源码解析-可执行程序-Bitcoind" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/比特币源码解析/2018-04-20-比特币源码解析-07-可执行程序-Bitcoind" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/10/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-07-%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F-Bitcoind/" class="article-date">
  <time class="dt-published" datetime="2018-05-10T03:59:36.000Z" itemprop="datePublished">2018-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/10/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-07-%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F-Bitcoind/">比特币源码解析-可执行程序-Bitcoind</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="00-摘要"><a href="#00-摘要" class="headerlink" title="00 摘要"></a>00 摘要</h3><p>bitcoin源码编译成功，将生成可执行文件：</p>
<ul>
<li><pre><code>bench_bitcoin: 作用是编译系统更新，主要检查系统使用的一些加密算法是否有新的更新。
      
</code></pre>
</li>
<li><pre><code>bitcoin-cli: Bitcoind的一个功能完备的RPC客户端
</code></pre>
</li>
<li><pre><code>bitcoind: 比特币核心执行程序，俗称bitcoin-core。
</code></pre>
</li>
<li><pre><code>bitcoin-qt: 比特币钱包
</code></pre>
</li>
<li><pre><code>bitcoin-tx: 比特币交易处理模块，支持交易的查询和创建。
</code></pre>
</li>
<li><pre><code>test_bitcoin: 运行各个模块的测试代码。
</code></pre>
</li>
<li><pre><code>test_bitcoin-qt: 运行钱包模块的测试代码。
</code></pre>
</li>
</ul>
<h3 id="01-Main"><a href="#01-Main" class="headerlink" title="01 Main"></a>01 Main</h3><p>首先寻找bitcoind的main函数。直接找到src/bitcoind.cpp;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">    SetupEnvironment();&#x2F;&#x2F;环境配置</span><br><span class="line">    &#x2F;&#x2F; Connect bitcoind signal handlers 连接bitcoind信号处理机制</span><br><span class="line">    noui_connect();</span><br><span class="line">    return (AppInit(argc, argv) ? EXIT_SUCCESS : EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="02-setEnvironment"><a href="#02-setEnvironment" class="headerlink" title="02 setEnvironment"></a>02 setEnvironment</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">void SetupEnvironment()</span><br><span class="line">&#123;</span><br><span class="line">#ifdef HAVE_MALLOPT_ARENA_MAX</span><br><span class="line">    &#x2F;&#x2F;判断计算机系统位数，32位系统创建一个堆内存，默认创建2</span><br><span class="line">    &#x2F;&#x2F; glibc-specific: On 32-bit systems set the number of arenas to 1.</span><br><span class="line">    &#x2F;&#x2F; By default, since glibc 2.10, the C library will create up to two heap</span><br><span class="line">    &#x2F;&#x2F; arenas per core. This is known to cause excessive virtual address space</span><br><span class="line">    &#x2F;&#x2F; usage in our usage. Work around it by setting the maximum number of</span><br><span class="line">    &#x2F;&#x2F; arenas to 1.</span><br><span class="line">    if (sizeof(void*) &#x3D;&#x3D; 4) &#123;</span><br><span class="line">        mallopt(M_ARENA_MAX, 1);</span><br><span class="line">    &#125;</span><br><span class="line">#endif</span><br><span class="line">    &#x2F;&#x2F; On most POSIX systems (e.g. Linux, but not BSD) the environment&#39;s locale</span><br><span class="line">    &#x2F;&#x2F; may be invalid, in which case the &quot;C&quot; locale is used as fallback.</span><br><span class="line">#if !defined(WIN32) &amp;&amp; !defined(MAC_OSX) &amp;&amp; !defined(__FreeBSD__) &amp;&amp; !defined(__OpenBSD__)</span><br><span class="line">    try &#123;</span><br><span class="line">        std::locale(&quot;&quot;); &#x2F;&#x2F; Raises a runtime error if current locale is invalid</span><br><span class="line">    &#125; catch (const std::runtime_error&amp;) &#123;</span><br><span class="line">        setenv(&quot;LC_ALL&quot;, &quot;C&quot;, 1);</span><br><span class="line">    &#125;</span><br><span class="line">#endif</span><br><span class="line">    &#x2F;&#x2F; The path locale is lazy initialized and to avoid deinitialization errors</span><br><span class="line">    &#x2F;&#x2F; in multithreading environments, it is set explicitly by the main thread.</span><br><span class="line">    &#x2F;&#x2F; A dummy locale is used to extract the internal default locale, used by</span><br><span class="line">    &#x2F;&#x2F; fs::path, which is then used to explicitly imbue the path.</span><br><span class="line">    std::locale loc &#x3D; fs::path::imbue(std::locale::classic());</span><br><span class="line">    fs::path::imbue(loc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数首先通过:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sizeof(void*) &#x3D;&#x3D; 4&#x2F;&#x2F;判断当前系统是否是32位</span><br></pre></td></tr></table></figure>

<p>如果是64位的话那么sizeof(void*)值就为8。<br>mallopt函数是用来控制malloc内存分配时的行为的(具体请参考<a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man3/mallopt.3.html">http://man7.org/linux/man-pages/man3/mallopt.3.html</a>)，<br>M_ARENA_MAX参数是值最多能创建的arena数，一个arena是指malloc在分内内存时的一个内存池，而这个arena是线程安全的，也就是说多线程访问时是互斥访问的，既然是互斥访问的，那么很明显，当arena数量越多时，线程的竞争就越小，但是需要的内存也就越多（因为arena就相当于一次性申请大量内存，然后在malloc时慢慢分配出去）。</p>
<p>通过代码中的注释，我们发现glibc库会为每个核创建2个arena，而这会对32为系统造成虚拟地址空间不足的问题，所以这里设为1.</p>
<p>locale()是设置系统区域，这将决定程序所使用的当前语言编码、日期格式、数字格式及其它与区域有关的设置。</p>
<p>最后两行是文件路径的本地化设置，主要设计宽字符(Wide char)和多字节(Multi bytes)之间的转换问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void noui_connect()</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; Connect bitcoind signal handlers</span><br><span class="line">    uiInterface.ThreadSafeMessageBox.connect(noui_ThreadSafeMessageBox);</span><br><span class="line">    uiInterface.ThreadSafeQuestion.connect(noui_ThreadSafeQuestion);</span><br><span class="line">    uiInterface.InitMessage.connect(noui_InitMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CClientUIInterface类中定义了一些信号，其中三个分别是ThreadSafeMessageBox，ThreadSafeQuestion和InitMessage。再看前面的noui_connect中的变量，我们发现通过connect连接的插槽函数定义和信号中的定义完全一致，所以当信号触发的时候，这些连接的函数都会被调用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/05/10/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-07-%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F-Bitcoind/" data-id="ckmsza5vz00cnow44ggpycfri" data-title="比特币源码解析-可执行程序-Bitcoind" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/比特币源码解析/2018-04-20-比特币源码解析-06-数据结构-共识" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/08/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-06-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%85%B1%E8%AF%86/" class="article-date">
  <time class="dt-published" datetime="2018-05-08T12:14:20.000Z" itemprop="datePublished">2018-05-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/08/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-06-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%85%B1%E8%AF%86/">比特币源码解析-数据结构-共识</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>共识机制是区块链研究领域的热点，比特币采用的是POW机制，通过大量的算例来解决一个困难性问题从而产生新的区块，而正因为产生新的区块需要大量的算例，网络中的节点才相信最长的链是最可靠的，这种最长链原则也是比特币中共识的原理。</p>
<p><strong>文件名 pramas.h</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class Consensus</span><br></pre></td></tr></table></figure>

<h3 id="Consensus"><a href="#Consensus" class="headerlink" title="Consensus"></a>Consensus</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">namespace Consensus &#123;</span><br><span class="line"></span><br><span class="line">enum DeploymentPos</span><br><span class="line">&#123;</span><br><span class="line">    DEPLOYMENT_TESTDUMMY,</span><br><span class="line">    DEPLOYMENT_CSV, &#x2F;&#x2F; Deployment of BIP68, BIP112, and BIP113.</span><br><span class="line">    DEPLOYMENT_SEGWIT, &#x2F;&#x2F; Deployment of BIP141, BIP143, and BIP147.</span><br><span class="line">    &#x2F;&#x2F; NOTE: Also add new deployments to VersionBitsDeploymentInfo in versionbits.cpp</span><br><span class="line">    MAX_VERSION_BITS_DEPLOYMENTS</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Struct for each individual consensus rule change using BIP9.</span><br><span class="line"> *&#x2F;</span><br><span class="line">struct BIP9Deployment &#123;</span><br><span class="line">    &#x2F;** Bit position to select the particular bit in nVersion. *&#x2F;</span><br><span class="line">    int bit;</span><br><span class="line">    &#x2F;** Start MedianTime for version bits miner confirmation. Can be a date in the past *&#x2F;</span><br><span class="line">    int64_t nStartTime;</span><br><span class="line">    &#x2F;** Timeout&#x2F;expiry MedianTime for the deployment attempt. *&#x2F;</span><br><span class="line">    int64_t nTimeout;</span><br><span class="line"></span><br><span class="line">    &#x2F;** Constant for nTimeout very far in the future. *&#x2F;</span><br><span class="line">    static constexpr int64_t NO_TIMEOUT &#x3D; std::numeric_limits&lt;int64_t&gt;::max();</span><br><span class="line"></span><br><span class="line">    &#x2F;** Special value for nStartTime indicating that the deployment is always active.</span><br><span class="line">     *  This is useful for testing, as it means tests don&#39;t need to deal with the activation</span><br><span class="line">     *  process (which takes at least 3 BIP9 intervals). Only tests that specifically test the</span><br><span class="line">     *  behaviour during activation cannot use this. *&#x2F;</span><br><span class="line">    static constexpr int64_t ALWAYS_ACTIVE &#x3D; -1;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Parameters that influence chain consensus.</span><br><span class="line"> * 影响共识的参数</span><br><span class="line"> *&#x2F;</span><br><span class="line">struct Params &#123;</span><br><span class="line">    uint256 hashGenesisBlock;   &#x2F;&#x2F;创世区块的哈希</span><br><span class="line">    int nSubsidyHalvingInterval;    &#x2F;&#x2F;奖励减半的时间间隔</span><br><span class="line">    &#x2F;** Block height at which BIP16 becomes active *&#x2F;</span><br><span class="line">    int BIP16Height;    &#x2F;&#x2F;区块高度</span><br><span class="line">    &#x2F;** Block height and hash at which BIP34 becomes active *&#x2F;</span><br><span class="line">    int BIP34Height;    &#x2F;&#x2F;区块Hash</span><br><span class="line">    uint256 BIP34Hash;</span><br><span class="line">    &#x2F;** Block height at which BIP65 becomes active *&#x2F;</span><br><span class="line">    int BIP65Height;</span><br><span class="line">    &#x2F;** Block height at which BIP66 becomes active *&#x2F;</span><br><span class="line">    int BIP66Height;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Minimum blocks including miner confirmation of the total of 2016 blocks in a retargeting period,</span><br><span class="line">     * (nPowTargetTimespan &#x2F; nPowTargetSpacing) which is also used for BIP9 deployments.</span><br><span class="line">     * Examples: 1916 for 95%, 1512 for testchains.</span><br><span class="line">     * 在2016个区块中至少要有多少个区块被矿工确认，规则改变才能生效</span><br><span class="line">     * 在BIP9上线时还使用(nPowTargetTimespan &#x2F; nPowTargetSpacing)值</span><br><span class="line">     *&#x2F;</span><br><span class="line">    uint32_t nRuleChangeActivationThreshold;</span><br><span class="line">    uint32_t nMinerConfirmationWindow;</span><br><span class="line">    BIP9Deployment vDeployments[MAX_VERSION_BITS_DEPLOYMENTS];</span><br><span class="line">    &#x2F;** Proof of work parameters *&#x2F;</span><br><span class="line">    &#x2F;&#x2F; POW参数</span><br><span class="line">    uint256 powLimit;   &#x2F;&#x2F;难度</span><br><span class="line">    bool fPowAllowMinDifficultyBlocks;&#x2F;&#x2F;是否允许最低难度</span><br><span class="line">    bool fPowNoRetargeting; &#x2F;&#x2F;不调整难度</span><br><span class="line">    int64_t nPowTargetSpacing; &#x2F;&#x2F;区块产生平均时间</span><br><span class="line">    int64_t nPowTargetTimespan; &#x2F;&#x2F;难度调整时间</span><br><span class="line">    int64_t DifficultyAdjustmentInterval() const &#123; return nPowTargetTimespan &#x2F; nPowTargetSpacing; &#125;</span><br><span class="line">    uint256 nMinimumChainWork;  &#x2F;&#x2F;当前难度最小值</span><br><span class="line">    uint256 defaultAssumeValid; &#x2F;&#x2F;在此区块之前的区块都认为是有效的</span><br><span class="line">&#125;;</span><br><span class="line">&#125; &#x2F;&#x2F; namespace Consensus</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/05/08/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-06-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%85%B1%E8%AF%86/" data-id="ckmsza5uc00ajow44h05nei6p" data-title="比特币源码解析-数据结构-共识" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Bitcoin/比特币源码解析/2018-04-20-比特币源码解析-05-数据结构-区块" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/08/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-05-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%8C%BA%E5%9D%97/" class="article-date">
  <time class="dt-published" datetime="2018-05-08T10:59:05.000Z" itemprop="datePublished">2018-05-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bitcoin/">Bitcoin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/08/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-05-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%8C%BA%E5%9D%97/">比特币源码解析-数据结构-区块</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>区块是区块链的基本组成机构，也是交易信息的载体，矿工通过挖矿的形式来产生新的区块并获得奖励，新块产生的过程也是一个交易打包的过程，只有加入到区块中的交易才会被系统所有其他节点所认可，才是有效的。</p>
<p><strong>文件名 //block.h</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class CBlockHeader</span><br></pre></td></tr></table></figure>

<h3 id="01-class-CBlockHeader"><a href="#01-class-CBlockHeader" class="headerlink" title="01 class CBlockHeader"></a>01 class CBlockHeader</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;** Nodes collect new transactions into a block, hash them into a hash tree,</span><br><span class="line"> * and scan through nonce values to make the block&#39;s hash satisfy proof-of-work</span><br><span class="line"> * requirements.  When they solve the proof-of-work, they broadcast the block</span><br><span class="line"> * to everyone and the block is added to the block chain.  The first transaction</span><br><span class="line"> * in the block is a special one that creates a new coin owned by the creator</span><br><span class="line"> * of the block.</span><br><span class="line"> * -------------</span><br><span class="line"> * 网络中的节点不断收集新的交易，然后以一个Merkle树的形式打包进区块block中，</span><br><span class="line"> * 打包的过程就是要完成工作量证明的要求，当节点解出了当前的随机数时，</span><br><span class="line"> * 网络就把当前的区块广播到其他所有节点，并且加到区块链上。</span><br><span class="line"> * 区块中的第一笔交易称之为CoinBase交易，是产生的新币，发送给区块的产生者</span><br><span class="line"> *&#x2F;</span><br><span class="line">class CBlockHeader &#x2F;&#x2F;区块头 类</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    &#x2F;&#x2F; header</span><br><span class="line">    int32_t nVersion;       &#x2F;&#x2F;版本号</span><br><span class="line">    uint256 hashPrevBlock;  &#x2F;&#x2F;前一个区块的哈希</span><br><span class="line">    uint256 hashMerkleRoot; &#x2F;&#x2F;Merkle 树根</span><br><span class="line">    uint32_t nTime;         &#x2F;&#x2F;时间戳</span><br><span class="line">    uint32_t nBits;         &#x2F;&#x2F;POW难度</span><br><span class="line">    uint32_t nNonce;        &#x2F;&#x2F;要找的随机数</span><br><span class="line"></span><br><span class="line">    CBlockHeader()</span><br><span class="line">    &#123;</span><br><span class="line">        SetNull();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ADD_SERIALIZE_METHODS;</span><br><span class="line"></span><br><span class="line">    template &lt;typename Stream, typename Operation&gt;</span><br><span class="line">    inline void SerializationOp(Stream&amp; s, Operation ser_action) &#123;</span><br><span class="line">        READWRITE(this-&gt;nVersion);</span><br><span class="line">        READWRITE(hashPrevBlock);</span><br><span class="line">        READWRITE(hashMerkleRoot);</span><br><span class="line">        READWRITE(nTime);</span><br><span class="line">        READWRITE(nBits);</span><br><span class="line">        READWRITE(nNonce);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void SetNull()</span><br><span class="line">    &#123;</span><br><span class="line">        nVersion &#x3D; 0;</span><br><span class="line">        hashPrevBlock.SetNull();</span><br><span class="line">        hashMerkleRoot.SetNull();</span><br><span class="line">        nTime &#x3D; 0;</span><br><span class="line">        nBits &#x3D; 0;</span><br><span class="line">        nNonce &#x3D; 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bool IsNull() const</span><br><span class="line">    &#123;</span><br><span class="line">        return (nBits &#x3D;&#x3D; 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    uint256 GetHash() const;</span><br><span class="line"></span><br><span class="line">    int64_t GetBlockTime() const</span><br><span class="line">    &#123;</span><br><span class="line">        return (int64_t)nTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="01-class-CBlock"><a href="#01-class-CBlock" class="headerlink" title="01 class CBlock"></a>01 class CBlock</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 区块类</span><br><span class="line">class CBlock : public CBlockHeader</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    &#x2F;&#x2F; network and disk</span><br><span class="line">    std::vector&lt;CTransactionRef&gt; vtx;   &#x2F;&#x2F;所有的交易集合</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; memory only</span><br><span class="line">    mutable bool fChecked;              &#x2F;&#x2F;交易是否验证过并构成Merkle树</span><br><span class="line"></span><br><span class="line">    CBlock()</span><br><span class="line">    &#123;</span><br><span class="line">        SetNull();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CBlock(const CBlockHeader &amp;header)</span><br><span class="line">    &#123;</span><br><span class="line">        SetNull();</span><br><span class="line">        *(static_cast&lt;CBlockHeader*&gt;(this)) &#x3D; header;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ADD_SERIALIZE_METHODS;</span><br><span class="line"></span><br><span class="line">    template &lt;typename Stream, typename Operation&gt;</span><br><span class="line">    inline void SerializationOp(Stream&amp; s, Operation ser_action) &#123;</span><br><span class="line">        READWRITE(*static_cast&lt;CBlockHeader*&gt;(this));</span><br><span class="line">        READWRITE(vtx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void SetNull()</span><br><span class="line">    &#123;</span><br><span class="line">        CBlockHeader::SetNull();</span><br><span class="line">        vtx.clear();</span><br><span class="line">        fChecked &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;获得区块头信息</span><br><span class="line">    CBlockHeader GetBlockHeader() const</span><br><span class="line">    &#123;</span><br><span class="line">        CBlockHeader block;</span><br><span class="line">        block.nVersion       &#x3D; nVersion;</span><br><span class="line">        block.hashPrevBlock  &#x3D; hashPrevBlock;</span><br><span class="line">        block.hashMerkleRoot &#x3D; hashMerkleRoot;</span><br><span class="line">        block.nTime          &#x3D; nTime;</span><br><span class="line">        block.nBits          &#x3D; nBits;</span><br><span class="line">        block.nNonce         &#x3D; nNonce;</span><br><span class="line">        return block;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::string ToString() const;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





      
    </div>
    <footer class="article-footer">
      <a data-url="http://winkyqin.com/2018/05/08/Bitcoin/%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/2018-04-20-%E6%AF%94%E7%89%B9%E5%B8%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-05-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%8C%BA%E5%9D%97/" data-id="ckmsza5vy00ckow4443a13xdz" data-title="比特币源码解析-数据结构-区块" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/6/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/">AI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Bitcoin/">Bitcoin</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/BlockChain/">BlockChain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python%E5%9F%BA%E7%A1%80/">Python基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ubuntu/">Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WinkyQin/">WinkyQin</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI/" rel="tag">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android%E9%9D%A2%E8%AF%95/" rel="tag">Android面试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS3/" rel="tag">CSS3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Celery/" rel="tag">Celery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FastDFS/" rel="tag">FastDFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitLab/" rel="tag">GitLab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle%E9%85%8D%E7%BD%AE/" rel="tag">Gradle配置</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GrowingIO/" rel="tag">GrowingIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JCenter/" rel="tag">JCenter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JitPack/" rel="tag">JitPack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux%E5%91%BD%E4%BB%A4/" rel="tag">Linux命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySql%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">MySql数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORMLite/" rel="tag">ORMLite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python%E5%9F%BA%E7%A1%80/" rel="tag">Python基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Retrofit/" rel="tag">Retrofit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rxjava/" rel="tag">Rxjava</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrapyd/" rel="tag">Scrapyd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tokyo/" rel="tag">Tokyo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/" rel="tag">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WinkyQin/" rel="tag">WinkyQin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apk%E6%89%93%E5%8C%85/" rel="tag">apk打包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app%E4%BC%98%E5%8C%96/" rel="tag">app优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crontab/" rel="tag">crontab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">java虚拟机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mini-Web/" rel="tag">mini-Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mini-Web%E6%A1%86%E6%9E%B6/" rel="tag">mini-Web框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tinker/" rel="tag">tinker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">web服务器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6/" rel="tag">事件传递机制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%A4%E6%98%93/" rel="tag">交易</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" rel="tag">代码规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/" rel="tag">位运算</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BF%E5%90%8D%E6%8A%80%E6%9C%AF/" rel="tag">匿名技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E4%BB%BB%E5%8A%A1/" rel="tag">多任务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E6%B8%A0%E9%81%93/" rel="tag">多渠道</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/" rel="tag">微信公众号</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%96%E7%9F%BF/" rel="tag">挖矿</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" rel="tag">智能合约</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B2%89%E6%B5%B8%E5%BC%8F/" rel="tag">沉浸式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E9%87%8F%E4%BC%98%E5%8C%96/" rel="tag">电量优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%80%E5%8E%86/" rel="tag">简历</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91/" rel="tag">编译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80/" rel="tag">自然语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B6%85%E7%BA%A7%E8%B4%A6%E6%9C%AC/" rel="tag">超级账本</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%92%B1%E5%8C%85/" rel="tag">钱包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">面向对象</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AI/" style="font-size: 10px;">AI</a> <a href="/tags/Android/" style="font-size: 12.73px;">Android</a> <a href="/tags/Android%E9%9D%A2%E8%AF%95/" style="font-size: 10px;">Android面试</a> <a href="/tags/CSS3/" style="font-size: 10px;">CSS3</a> <a href="/tags/Celery/" style="font-size: 10px;">Celery</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/FastDFS/" style="font-size: 10px;">FastDFS</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitLab/" style="font-size: 11.82px;">GitLab</a> <a href="/tags/Gradle%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">Gradle配置</a> <a href="/tags/GrowingIO/" style="font-size: 10px;">GrowingIO</a> <a href="/tags/JCenter/" style="font-size: 10px;">JCenter</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/JitPack/" style="font-size: 10px;">JitPack</a> <a href="/tags/Linux/" style="font-size: 10.91px;">Linux</a> <a href="/tags/Linux%E5%91%BD%E4%BB%A4/" style="font-size: 15.45px;">Linux命令</a> <a href="/tags/MongoDB/" style="font-size: 10.91px;">MongoDB</a> <a href="/tags/MySql%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">MySql数据库</a> <a href="/tags/ORMLite/" style="font-size: 10px;">ORMLite</a> <a href="/tags/Python/" style="font-size: 13.64px;">Python</a> <a href="/tags/Python%E5%9F%BA%E7%A1%80/" style="font-size: 20px;">Python基础</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Retrofit/" style="font-size: 10.91px;">Retrofit</a> <a href="/tags/Rxjava/" style="font-size: 10px;">Rxjava</a> <a href="/tags/Scrapy/" style="font-size: 18.18px;">Scrapy</a> <a href="/tags/Scrapyd/" style="font-size: 10px;">Scrapyd</a> <a href="/tags/Tokyo/" style="font-size: 10px;">Tokyo</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/Ubuntu/" style="font-size: 10.91px;">Ubuntu</a> <a href="/tags/WinkyQin/" style="font-size: 10.91px;">WinkyQin</a> <a href="/tags/apk%E6%89%93%E5%8C%85/" style="font-size: 10px;">apk打包</a> <a href="/tags/app%E4%BC%98%E5%8C%96/" style="font-size: 10px;">app优化</a> <a href="/tags/crontab/" style="font-size: 10px;">crontab</a> <a href="/tags/java%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 10px;">java虚拟机</a> <a href="/tags/mini-Web/" style="font-size: 10px;">mini-Web</a> <a href="/tags/mini-Web%E6%A1%86%E6%9E%B6/" style="font-size: 10px;">mini-Web框架</a> <a href="/tags/redis/" style="font-size: 10.91px;">redis</a> <a href="/tags/tinker/" style="font-size: 10px;">tinker</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/web%E6%9C%8D%E5%8A%A1%E5%99%A8/" style="font-size: 10px;">web服务器</a> <a href="/tags/%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6/" style="font-size: 10px;">事件传递机制</a> <a href="/tags/%E4%BA%A4%E6%98%93/" style="font-size: 10px;">交易</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 10px;">代码规范</a> <a href="/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/" style="font-size: 10px;">位运算</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 16.36px;">区块链</a> <a href="/tags/%E5%8C%BF%E5%90%8D%E6%8A%80%E6%9C%AF/" style="font-size: 10px;">匿名技术</a> <a href="/tags/%E5%A4%9A%E4%BB%BB%E5%8A%A1/" style="font-size: 10px;">多任务</a> <a href="/tags/%E5%A4%9A%E6%B8%A0%E9%81%93/" style="font-size: 10px;">多渠道</a> <a href="/tags/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/" style="font-size: 10px;">微信公众号</a> <a href="/tags/%E6%8C%96%E7%9F%BF/" style="font-size: 10px;">挖矿</a> <a href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" style="font-size: 10px;">智能合约</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">机器学习</a> <a href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" style="font-size: 19.09px;">比特币</a> <a href="/tags/%E6%B2%89%E6%B5%B8%E5%BC%8F/" style="font-size: 10px;">沉浸式</a> <a href="/tags/%E7%94%B5%E9%87%8F%E4%BC%98%E5%8C%96/" style="font-size: 10px;">电量优化</a> <a href="/tags/%E7%AE%80%E5%8E%86/" style="font-size: 10px;">简历</a> <a href="/tags/%E7%BC%96%E8%AF%91/" style="font-size: 10px;">编译</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">网络</a> <a href="/tags/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80/" style="font-size: 14.55px;">自然语言</a> <a href="/tags/%E8%B6%85%E7%BA%A7%E8%B4%A6%E6%9C%AC/" style="font-size: 16.36px;">超级账本</a> <a href="/tags/%E9%92%B1%E5%8C%85/" style="font-size: 10.91px;">钱包</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 17.27px;">面向对象</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/28/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/02/25/WinkyQin/self_info/">个人简历-危勤</a>
          </li>
        
          <li>
            <a href="/2021/02/24/Python%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Python%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86-03/">3. 处理原始文本</a>
          </li>
        
          <li>
            <a href="/2021/02/24/Python%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Python%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86-02/">2. 获得文本语料和词汇资源</a>
          </li>
        
          <li>
            <a href="/2021/02/24/Python%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Python%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86-01/">语言处理与Python</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 WinkyQin<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>